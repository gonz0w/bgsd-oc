---
phase: 09-tech-debt-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/commands/roadmap.js
  - src/router.js
  - src/lib/constants.js
  - bin/gsd-tools.test.cjs
  - bin/gsd-tools.cjs
  - templates/plans/execute.md
  - templates/plans/tdd.md
  - templates/plans/discovery.md
  - .planning/REQUIREMENTS.md
  - .planning/ROADMAP.md
autonomous: true
requirements:
  - DEBT-01
  - DEBT-02
  - DEBT-03
must_haves:
  truths:
    - "`npm test` passes with zero failures"
    - "Every top-level command responds to `--help` with usage text"
    - "The no-command usage string lists all 44 commands"
    - "Generic plan template files exist in templates/plans/"
  artifacts:
    - path: "templates/plans/execute.md"
      provides: "Standard execute plan template"
    - path: "templates/plans/tdd.md"
      provides: "TDD plan template with red-green-refactor structure"
    - path: "templates/plans/discovery.md"
      provides: "Discovery/research plan template"
    - path: "bin/gsd-tools.cjs"
      provides: "Rebuilt CLI with test fix and usage string update"
  key_links:
    - from: "bin/gsd-tools.test.cjs"
      to: "bin/gsd-tools.cjs"
      via: "test runner executes CLI"
      pattern: "npm test"
---

<objective>
Resolve all three tech debt items: fix the broken test, complete --help coverage, and create generic plan templates.

Purpose: Close out v1.1 milestone by resolving pre-existing tech debt from v1.0.
Output: All tests passing, help coverage complete, plan templates created.
</objective>

<execution_context>
@__OPENCODE_CONFIG__/get-shit-done/workflows/execute-plan.md
@__OPENCODE_CONFIG__/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/TESTING.md
@.planning/codebase/CONVENTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix failing roadmap analyze test and update usage string</name>
  <files>
    bin/gsd-tools.test.cjs
    src/router.js
  </files>
  <action>
**DEBT-01 — Fix the failing test:**

In `bin/gsd-tools.test.cjs` at line 1514, the test `parses phases with goals and disk status` asserts:
```js
assert.strictEqual(output.progress_percent, 50, '50% complete');
```

The test creates 3 phases (Foundation, Authentication, Features). Phase 1 has both PLAN and SUMMARY (complete), Phase 2 has only PLAN (planned), Phase 3 has no directory. The `progress_percent` field was changed in v1.0 bug fixes to be phase-based (`completedPhases / phases.length`) instead of plan-based. So `1/3 = 33%`, not `50%`.

Fix: Change line 1514 to expect `33` instead of `50`:
```js
assert.strictEqual(output.progress_percent, 33, '33% complete (1 of 3 phases)');
```

The old plan-based metric is still available as `plan_progress_percent`. Add an assertion for it:
```js
assert.strictEqual(output.plan_progress_percent, 50, '50% plan progress (1 summary / 2 plans)');
```

**DEBT-02 — Update the no-command usage string:**

In `src/router.js`, find the `error("Usage: gsd-tools <command> [args] [--raw]\nCommands: ...")` call. The command list is stale (27 commands). Replace it with all 44 commands sorted alphabetically:

```
codebase-impact, commit, config-ensure-section, config-get, config-migrate, config-set, context-budget, current-timestamp, extract-sections, find-phase, frontmatter, generate-slug, history-digest, init, list-todos, milestone, phase, phase-plan-index, phases, progress, quick-summary, requirements, resolve-model, roadmap, rollback-info, scaffold, search-decisions, search-lessons, session-diff, state, state-snapshot, summary-extract, template, test-run, todo, trace-requirement, validate, validate-config, validate-dependencies, velocity, verify, verify-path-exists, verify-summary, websearch
```

After both changes, rebuild: `node build.js`

Then run tests: `npm test` — all 202 tests must pass with 0 failures.
  </action>
  <verify>
`npm test` outputs `pass 202, fail 0`. Specifically verify the previously-failing test now passes:
```bash
node --test --test-name-pattern="parses phases with goals" bin/gsd-tools.test.cjs
```
Also verify the usage string is updated:
```bash
node bin/gsd-tools.cjs 2>&1 | grep "extract-sections"
```
  </verify>
  <done>All 202 tests pass. No-command usage string lists all 44 commands including previously-missing ones like extract-sections, websearch, scaffold, phases.</done>
</task>

<task type="auto">
  <name>Task 2: Create generic plan templates in templates/plans/</name>
  <files>
    templates/plans/execute.md
    templates/plans/tdd.md
    templates/plans/discovery.md
  </files>
  <action>
**DEBT-03 — Create generic plan templates:**

Create `templates/plans/` directory with three template files. These are markdown templates that the `template fill plan` command and planners can reference. They follow the PLAN.md structure from the GSD planning system.

**`templates/plans/execute.md`** — Standard execution plan template:
- Frontmatter with all required fields: phase, plan, type: execute, wave, depends_on, files_modified, autonomous, requirements, must_haves
- Sections: objective, execution_context, context, tasks (with XML task structure showing type="auto" example), verification, success_criteria, output
- Placeholder values use `[bracket notation]` per project convention
- Include one example `<task type="auto">` with all required child elements: name, files, action, verify, done
- Include one example verification task (type with human-verify gate) showing what-built, how-to-verify, resume-signal

**`templates/plans/tdd.md`** — TDD plan template:
- Frontmatter with type: tdd
- Sections: objective, execution_context, context, feature (with name, files, behavior, implementation), verification, success_criteria, output
- Document the RED→GREEN→REFACTOR cycle in comments
- Include commit message format: `test({phase}-{plan}):`, `feat({phase}-{plan}):`, `refactor({phase}-{plan}):`

**`templates/plans/discovery.md`** — Discovery/research plan template:
- Frontmatter with type: execute (discovery plans are executed, they just produce research artifacts)
- Sections: objective (focused on answering questions), context, tasks (research-oriented: evaluate options, prototype, document findings), verification, success_criteria, output
- Tasks focus on producing DISCOVERY.md or RESEARCH.md artifacts
- Include example task for library evaluation with verify criteria

Each template should be self-contained and immediately usable by copying into a phase directory and filling in placeholders.
  </action>
  <verify>
```bash
ls templates/plans/
# Should show: execute.md, tdd.md, discovery.md

# Verify each has valid frontmatter
node bin/gsd-tools.cjs frontmatter get templates/plans/execute.md --raw
node bin/gsd-tools.cjs frontmatter get templates/plans/tdd.md --raw
node bin/gsd-tools.cjs frontmatter get templates/plans/discovery.md --raw
```
All three files exist and have parseable YAML frontmatter.
  </verify>
  <done>Three generic plan templates exist in templates/plans/ (execute.md, tdd.md, discovery.md). Each has valid frontmatter and complete section structure following GSD PLAN.md conventions.</done>
</task>

<task type="auto">
  <name>Task 3: Update requirements and roadmap to reflect DEBT-03 change</name>
  <files>
    .planning/REQUIREMENTS.md
    .planning/ROADMAP.md
  </files>
  <action>
Update DEBT-03 in REQUIREMENTS.md from project-specific templates to generic GSD templates:

Change:
```
- [ ] **DEBT-03**: Plan template files exist in `templates/plans/` for common patterns
```
To:
```
- [ ] **DEBT-03**: Generic plan template files exist in `templates/plans/` (execute, tdd, discovery)
```

Update Phase 9 success criteria #3 in ROADMAP.md from:
```
3. Plan template files exist in `templates/plans/` for common patterns (at minimum: ash-resource, pulsar-function, go-service)
```
To:
```
3. Generic plan template files exist in `templates/plans/` for GSD plan types (execute, tdd, discovery)
```

Update Phase 9 plan status in ROADMAP.md:
```
**Plans**: 1 plan
Plans:
- [ ] 09-01-PLAN.md — Fix test, complete help coverage, create generic plan templates [DEBT-01, DEBT-02, DEBT-03]
```

Also update the bullet summary line:
```
- [ ] **Phase 9: Tech Debt Cleanup** (1 plan) - Fix broken test, complete --help coverage, create plan templates
```
  </action>
  <verify>
```bash
grep "DEBT-03" .planning/REQUIREMENTS.md
grep "templates/plans" .planning/ROADMAP.md
grep "1 plan" .planning/ROADMAP.md
```
DEBT-03 description mentions generic templates. ROADMAP success criteria references execute/tdd/discovery. Plan count shows 1.
  </verify>
  <done>REQUIREMENTS.md and ROADMAP.md reflect the updated DEBT-03 scope (generic GSD templates, not project-specific). Phase 9 shows 1 plan in roadmap.</done>
</task>

</tasks>

<verification>
1. `npm test` passes with 0 failures (DEBT-01)
2. `node bin/gsd-tools.cjs 2>&1` lists all 44 commands in usage string (DEBT-02)
3. `node bin/gsd-tools.cjs extract-sections --help 2>&1` returns usage text (DEBT-02 spot check)
4. `ls templates/plans/` shows execute.md, tdd.md, discovery.md (DEBT-03)
5. `node bin/gsd-tools.cjs frontmatter get templates/plans/execute.md --raw` parses successfully (DEBT-03)
</verification>

<success_criteria>
- [ ] All 202+ tests pass with zero failures
- [ ] No-command usage string is complete and alphabetized
- [ ] Three generic plan templates exist with valid frontmatter
- [ ] REQUIREMENTS.md and ROADMAP.md updated to reflect actual DEBT-03 scope
</success_criteria>

<output>
After completion, create `.planning/phases/09-tech-debt-cleanup/09-01-SUMMARY.md`
</output>
