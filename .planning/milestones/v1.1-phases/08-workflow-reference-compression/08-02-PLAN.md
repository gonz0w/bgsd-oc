---
phase: 08-workflow-reference-compression
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - workflows/execute-phase.md
  - workflows/execute-plan.md
  - workflows/verify-phase.md
  - workflows/verify-work.md
  - workflows/new-project.md
  - workflows/complete-milestone.md
  - workflows/plan-phase.md
  - workflows/quick.md
autonomous: true
requirements: [WKFL-03]

must_haves:
  truths:
    - "Top 6 workflows by token count are measurably smaller after deduplication"
    - "Agent behavior is preserved — workflows still produce correct output"
    - "Shared boilerplate is consolidated into references that multiple workflows load"
  artifacts:
    - path: "workflows/execute-phase.md"
      provides: "Compressed execute-phase workflow"
    - path: "workflows/execute-plan.md"
      provides: "Compressed execute-plan workflow"
    - path: "workflows/verify-phase.md"
      provides: "Compressed verify-phase workflow"
    - path: "workflows/verify-work.md"
      provides: "Compressed verify-work workflow"
    - path: "workflows/new-project.md"
      provides: "Compressed new-project workflow"
    - path: "workflows/complete-milestone.md"
      provides: "Compressed complete-milestone workflow"
  key_links:
    - from: "workflows/execute-phase.md"
      to: "references/checkpoints.md"
      via: "selective section loading instead of full file"
      pattern: "extract-sections.*checkpoints"
---

<objective>
Compress the top 6 workflows by size through deduplication, prose tightening, and selective reference loading — achieving measurable line-count and token reduction.

Purpose: The top 6 workflows account for 61,829 tokens (execute-phase 22,839, verify-phase 10,205, new-project 8,560, execute-plan 7,703, verify-work 7,077, complete-milestone 5,445). Reducing these by 30%+ directly addresses the WKFL-03 requirement for consolidated boilerplate. This is the highest-impact plan in Phase 8.

Output: Compressed workflow files with measurable before/after token deltas.
</objective>

<execution_context>
@__OPENCODE_CONFIG__/get-shit-done/workflows/execute-plan.md
@__OPENCODE_CONFIG__/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/08-workflow-reference-compression/08-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compress top 3 workflows (execute-phase, verify-phase, new-project)</name>
  <files>workflows/execute-phase.md, workflows/verify-phase.md, workflows/new-project.md</files>
  <action>
**Measure before:** Run `node bin/gsd-tools.cjs context-budget workflows/execute-phase.md --raw`, same for verify-phase.md and new-project.md. Record token counts.

**Compression strategy — apply ALL of these techniques to each file:**

**A. Selective reference loading (biggest win for execute-phase.md):**

execute-phase.md currently loads full `checkpoints.md` (776 lines), `tdd.md` (263 lines), `summary.md` (248 lines) via `@` references in the executor spawn prompt. Instead:
- Replace `@.../references/checkpoints.md` with a note: "Load checkpoints.md sections 'types' and 'guidelines' via extract-sections if plan has `autonomous: false`"
- Replace `@.../references/tdd.md` with: "Load tdd.md only if plan type is 'tdd'"
- Keep `@.../templates/summary.md` (always needed by executor)

This changes the `execution_context` block in the agent spawn prompt from loading all files unconditionally to conditional loading instructions. The executor agent reads these instructions and uses `extract-sections` to load only what it needs.

**B. Prose tightening (all files):**

Rewrite verbose explanations into terse, imperative instructions. The AI agent doesn't need persuasion or rationale — it needs clear commands.

Examples of compression patterns:
- "This step is responsible for loading all the context needed by..." → Remove entirely (self-evident from the code)
- Multi-sentence explanations of what a bash command does → Single-line comment above the command
- Repeated field-by-field JSON parse descriptions → "Parse JSON for: {field-list}" (one line)
- Example blocks that show "Bad" vs "Good" → Keep only the "Good" example if the pattern is clear
- Step descriptions that repeat the step name → Remove the description

**C. Redundant block removal:**

- Remove `<context_efficiency>` blocks that just restate the core principle
- Remove `<failure_handling>` blocks where the behavior is "stop and tell the user" (the default)
- Collapse `<resumption>` one-liners into the step they relate to
- Remove inline code comments that repeat what the code does

**D. Init call updates:**

Where workflows call `init` commands, add `--compact` flag:
```bash
# Before:
INIT=$(node .../bin/gsd-tools.cjs init execute-phase "${PHASE_ARG}")
# After:
INIT=$(node .../bin/gsd-tools.cjs init execute-phase "${PHASE_ARG}" --compact)
```

Update the field-parsing description to match compact output (fewer fields).

**CRITICAL RULES:**
1. Do NOT remove any behavioral logic, decision branches, or checkpoint handling
2. Do NOT remove any bash commands or their essential arguments
3. Do NOT change the structure of Task() spawn prompts beyond reference changes
4. DO preserve all step names and their ordering
5. DO preserve all XML tags (`<step>`, `<process>`, etc.)
6. Test that each workflow still reads correctly as an orchestration script

**Measure after:** Run context-budget on each file again. Target: 25-35% reduction per file.
  </action>
  <verify>
```bash
# Measure token reduction for each file
for f in execute-phase.md verify-phase.md new-project.md; do
  before=$(node bin/gsd-tools.cjs context-budget "workflows/$f" --raw 2>/dev/null | python3 -c "import json,sys; print(json.load(sys.stdin).get('token_estimate',0))")
  echo "$f: now $before tokens"
done

# Verify structural integrity — key patterns still present
rg 'step name=' workflows/execute-phase.md | wc -l   # Should be same count as before
rg 'Task\(' workflows/execute-phase.md | wc -l        # Should be same count
rg 'step name=' workflows/new-project.md | wc -l

# Build + test
npm run build && npm test
```
  </verify>
  <done>
execute-phase.md, verify-phase.md, and new-project.md are measurably smaller (25-35% line reduction each). All step names, bash commands, Task() prompts, and decision branches preserved. Selective reference loading replaces unconditional full-file loading.
  </done>
</task>

<task type="auto">
  <name>Task 2: Compress next 3 workflows (execute-plan, verify-work, complete-milestone) + plan-phase + quick</name>
  <files>workflows/execute-plan.md, workflows/verify-work.md, workflows/complete-milestone.md, workflows/plan-phase.md, workflows/quick.md</files>
  <action>
**Apply the same compression techniques from Task 1 to these 5 workflows:**

**execute-plan.md (485 lines, 7,703 tokens):**
- Loads checkpoints.md and git-integration.md — make conditional (load checkpoints sections only if plan has checkpoint tasks, load git-integration only for commit patterns)
- Tighten the task execution loop descriptions
- Remove example blocks that duplicate the reference content

**verify-work.md (569 lines, 7,077 tokens):**
- Long UAT methodology descriptions — compress to essential steps
- Remove examples where the pattern is already clear from the template reference

**complete-milestone.md (700 lines, 5,445 tokens):**
- Very long milestone completion ceremony — tighten each step
- Remove redundant success_criteria that repeat step content

**plan-phase.md (455 lines, 4,892 tokens):**
- Long agent spawn prompt templates — tighten context blocks
- Remove inline comments explaining init JSON fields (agents know the schema)
- Add `--compact` to init calls

**quick.md (453 lines):**
- Tighten the ad-hoc task workflow
- Remove verbose mode explanations

**Same rules as Task 1:** Preserve all behavioral logic, step names, bash commands, Task() prompts, decision branches. Only remove prose, examples, redundant explanations, and comments.

**Measure before and after** for each file.
  </action>
  <verify>
```bash
# Check all 5 files compressed
for f in execute-plan.md verify-work.md complete-milestone.md plan-phase.md quick.md; do
  lines=$(wc -l < "workflows/$f")
  echo "$f: $lines lines"
done

# Structural integrity
for f in execute-plan.md verify-work.md complete-milestone.md plan-phase.md quick.md; do
  steps=$(rg -c 'step name=|## [0-9]+\.' "workflows/$f" 2>/dev/null || echo 0)
  echo "$f: $steps structural markers"
done

# Build + test
npm run build && npm test
```
  </verify>
  <done>
All 8 top workflows compressed with 25-35% line/token reduction. No behavioral changes — same steps, same bash commands, same Task() prompts, same decision logic. Init calls use `--compact` where applicable.
  </done>
</task>

</tasks>

<verification>
- [ ] Top 6 workflows measurably smaller (record before/after in SUMMARY.md)
- [ ] execute-phase.md no longer unconditionally loads full checkpoints.md (776 lines)
- [ ] All step names preserved in every compressed workflow
- [ ] All Task() spawn prompts preserved (may have trimmed references)
- [ ] All bash commands preserved
- [ ] `npm run build` succeeds
- [ ] `npm test` passes
</verification>

<success_criteria>
- Combined token reduction across top 6 workflows is >= 20% (conservative, since some reduction comes from reference changes not measurable per-file)
- Each compressed workflow preserves ALL behavioral steps and decision branches
- No workflow loses any `<step>` elements
- Init calls updated to use `--compact` flag
</success_criteria>

<output>
After completion, create `.planning/phases/08-workflow-reference-compression/08-02-SUMMARY.md`
</output>
