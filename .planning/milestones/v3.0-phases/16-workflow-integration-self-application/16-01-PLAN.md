---
phase: 16-workflow-integration-self-application
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/commands/intent.js
  - src/commands/init.js
  - bin/gsd-tools.cjs
  - bin/gsd-tools.test.cjs
autonomous: true
requirements: [WINT-01]

must_haves:
  truths:
    - "Running `init progress --raw` includes intent_summary with objective and outcome count"
    - "Running `init execute-phase --raw` includes intent_summary alongside existing intent_drift"
    - "Running `init plan-phase --raw` includes intent_summary and intent_path"
  artifacts:
    - path: "src/commands/intent.js"
      provides: "getIntentSummary() exported function"
      exports: ["getIntentSummary"]
    - path: "src/commands/init.js"
      provides: "intent_summary field in 3 init commands"
      contains: "intent_summary"
    - path: "bin/gsd-tools.cjs"
      provides: "Rebuilt bundle with intent summary"
  key_links:
    - from: "src/commands/init.js"
      to: "src/commands/intent.js"
      via: "require('./intent') getIntentSummary import"
      pattern: "getIntentSummary"
    - from: "getIntentSummary"
      to: "parseIntentMd"
      via: "helpers.js parser"
      pattern: "parseIntentMd"
---

<objective>
Add getIntentSummary() function and wire intent context into all three init commands so every downstream agent automatically sees the project's intent.

Purpose: Agents need project intent (objective, desired outcomes) in their context to make aligned decisions. Currently only execute-phase gets intent_drift — but agents need the actual intent *content*, not just drift metrics.
Output: getIntentSummary() function, intent_summary field in init progress/execute-phase/plan-phase, intent_path in plan-phase.
</objective>

<execution_context>
@__OPENCODE_CONFIG__/get-shit-done/workflows/execute-plan.md
@__OPENCODE_CONFIG__/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/15-intent-tracing-validation/15-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: getIntentSummary function and init command injection</name>
  <files>src/commands/intent.js, src/commands/init.js</files>
  <action>
**In src/commands/intent.js** — Add a new exported function `getIntentSummary(cwd)`:

```javascript
function getIntentSummary(cwd) {
  const intentPath = path.join(cwd, '.planning', 'INTENT.md');
  if (!fs.existsSync(intentPath)) return null;
  
  const content = fs.readFileSync(intentPath, 'utf-8');
  const data = parseIntentMd(content);
  
  if (!data.objective?.statement) return null;
  
  return {
    objective: data.objective.statement,
    outcome_count: data.outcomes?.length || 0,
    top_outcomes: (data.outcomes || [])
      .filter(o => o.priority === 'P1')
      .slice(0, 3)
      .map(o => ({ id: o.id, text: o.text })),
    users: (data.users || []).slice(0, 3).map(u => u.text),
    has_criteria: (data.criteria || []).length > 0,
  };
}
```

Follow the same try/catch advisory pattern as getIntentDriftData. Export it alongside existing exports.

**In src/commands/init.js** — Import getIntentSummary alongside existing getIntentDriftData:
```javascript
const { getIntentDriftData, getIntentSummary } = require('./intent');
```

**cmdInitProgress** (around line 955): Add `intent_summary` field to result object. Wrap in try/catch like intent_drift:
```javascript
// Intent summary (null if no INTENT.md)
intent_summary: null,
```
Then after result construction:
```javascript
try {
  result.intent_summary = getIntentSummary(cwd);
} catch (e) {
  debugLog('init.progress', 'intent summary failed (non-blocking)', e);
}
```
Include intent_summary in compact mode output as well.

**cmdInitExecutePhase** (around line 28): Add `intent_summary: null` to result object. After existing intent_drift try/catch block, add similar try/catch for intent_summary. Include in compact mode output.

**cmdInitPlanPhase** (around line 161): Add `intent_summary: null` and `intent_path: null` to result. After result construction, populate:
```javascript
try {
  result.intent_summary = getIntentSummary(cwd);
  const intentFile = path.join(cwd, '.planning', 'INTENT.md');
  if (fs.existsSync(intentFile)) {
    result.intent_path = '.planning/INTENT.md';
  }
} catch (e) {
  debugLog('init.planPhase', 'intent summary failed (non-blocking)', e);
}
```
Include both intent_summary and intent_path in compact mode output (only if non-null).

**IMPORTANT**: Follow the exact advisory pattern from Phase 15 — never crash, never block. If INTENT.md is missing or malformed, field stays null. No new dependencies.
  </action>
  <verify>
Run `npm test` — all existing tests pass (335+). Then verify manually:
```bash
# Create a test INTENT.md first if one doesn't exist
node bin/gsd-tools.cjs init progress --raw 2>/dev/null | python3 -c "import json,sys; d=json.load(sys.stdin); print(f'intent_summary: {d.get(\"intent_summary\", \"MISSING KEY\")}')"
node bin/gsd-tools.cjs init plan-phase 16 --raw 2>/dev/null | python3 -c "import json,sys; d=json.load(sys.stdin); print(f'intent_summary: {d.get(\"intent_summary\")}, intent_path: {d.get(\"intent_path\")}')"
```
  </verify>
  <done>All 3 init commands return intent_summary (null when no INTENT.md, populated object when INTENT.md exists). Plan-phase also returns intent_path. Zero regressions.</done>
</task>

<task type="auto">
  <name>Task 2: Rebuild bundle and add integration tests</name>
  <files>bin/gsd-tools.cjs, bin/gsd-tools.test.cjs</files>
  <action>
**Rebuild bundle:**
```bash
npm run build
```

**Add integration tests** in bin/gsd-tools.test.cjs — new test suite "Intent Summary in Init Commands":

1. Test: `getIntentSummary returns null when no INTENT.md` — run in temp dir with no INTENT.md, verify null
2. Test: `getIntentSummary returns summary when INTENT.md exists` — create temp INTENT.md with known content, verify objective, outcome_count, top_outcomes
3. Test: `init progress includes intent_summary field` — verify field present in output JSON
4. Test: `init plan-phase includes intent_path field` — verify intent_path present when INTENT.md exists

Follow existing test patterns (use execSync to call gsd-tools.cjs, parse JSON output). Keep tests focused — 4-6 tests total.

Run `npm test` and verify all tests pass including new ones. Check bundle size stays within 450KB budget.
  </action>
  <verify>
```bash
npm test
# Expect: all existing tests + 4-6 new tests pass
node -e "const s=require('fs').statSync('bin/gsd-tools.cjs'); console.log('Bundle:', Math.round(s.size/1024)+'KB')"
# Expect: ≤450KB
```
  </verify>
  <done>Bundle rebuilt with getIntentSummary wired through. 4-6 new integration tests pass. Bundle size within 450KB budget. Zero regressions on existing 335+ tests.</done>
</task>

</tasks>

<verification>
- `npm test` passes all tests (existing + new)
- `init progress --raw` includes `intent_summary` key
- `init execute-phase 16 --raw` includes `intent_summary` key
- `init plan-phase 16 --raw` includes `intent_summary` and `intent_path` keys
- No INTENT.md → all intent fields are null (not errors)
- With INTENT.md → intent_summary populated with objective, outcome_count, top_outcomes
</verification>

<success_criteria>
All three init commands expose intent context. Agents receiving init output now see project intent automatically. Advisory pattern maintained — missing INTENT.md produces null, never errors.
</success_criteria>

<output>
After completion, create `.planning/phases/16-workflow-integration-self-application/16-01-SUMMARY.md`
</output>
