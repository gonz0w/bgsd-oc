---
phase: 16-workflow-integration-self-application
plan: 03
type: execute
wave: 2
depends_on: [16-01]
files_modified:
  - workflows/research-phase.md
  - workflows/plan-phase.md
  - workflows/verify-work.md
  - workflows/verify-phase.md
autonomous: true
requirements: [WINT-02, WINT-03, WINT-04]

must_haves:
  truths:
    - "Research agent prompt includes INTENT.md in files_to_read so it sees project intent"
    - "Planner agent prompt includes INTENT.md reference and instruction to derive plan objectives from desired outcomes"
    - "Verify-work workflow extracts tests from INTENT.md desired outcomes alongside SUMMARY accomplishments"
    - "Verify-phase workflow includes intent outcomes in truth derivation"
  artifacts:
    - path: "workflows/research-phase.md"
      provides: "Intent context in researcher spawn"
      contains: "INTENT.md"
    - path: "workflows/plan-phase.md"
      provides: "Intent context in researcher and planner spawns"
      contains: "intent_path"
    - path: "workflows/verify-work.md"
      provides: "Intent-aware test extraction"
      contains: "desired outcomes"
    - path: "workflows/verify-phase.md"
      provides: "Intent outcomes in verification criteria"
      contains: "INTENT.md"
  key_links:
    - from: "workflows/plan-phase.md"
      to: "init plan-phase output"
      via: "intent_path and intent_summary from INIT JSON"
      pattern: "intent_path"
    - from: "workflows/research-phase.md"
      to: ".planning/INTENT.md"
      via: "files_to_read reference"
      pattern: "INTENT.md"
    - from: "workflows/verify-work.md"
      to: ".planning/INTENT.md"
      via: "outcome-based test generation"
      pattern: "desired outcomes"
---

<objective>
Inject intent context into research, planning, and verification workflows so agents automatically align their work with stated project intent.

Purpose: Without workflow integration, intent data exists but agents don't see it. This makes intent a passive document rather than an active alignment tool. After this plan, every major GSD workflow reads and uses INTENT.md.
Output: Updated workflow .md files with intent context injection points.
</objective>

<execution_context>
@__OPENCODE_CONFIG__/get-shit-done/workflows/execute-plan.md
@__OPENCODE_CONFIG__/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/16-workflow-integration-self-application/16-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add intent context to research and planning workflows</name>
  <files>workflows/research-phase.md, workflows/plan-phase.md</files>
  <action>
**workflows/research-phase.md** — In Step 4 (Spawn Researcher), add INTENT.md to the researcher's `<files_to_read>` section. Currently the researcher reads context_path, requirements_path, and state_path. Add:

```
- .planning/INTENT.md (Project intent — objective, desired outcomes, target users. Skip if absent.)
```

Also add to `<additional_context>`:
```
If INTENT.md exists: scope research to align with stated project objective and desired outcomes. Prioritize findings relevant to P1 outcomes.
```

This is a 2-line addition to the existing spawn prompt. The researcher already handles missing files gracefully.

**workflows/plan-phase.md** — Two injection points:

1. **Step 5 (Research spawn)** — Same as research-phase: add INTENT.md to researcher's files_to_read. Add instruction: "Scope research to project intent if INTENT.md exists."

2. **Step 9 (Planner spawn)** — Add to planner's Read list:
```
Read: {state_path}, {roadmap_path}, {requirements_path}, {context_path}, {research_path}, .planning/INTENT.md (if exists)
```
Add instruction to planner prompt:
```
If INTENT.md exists: derive plan objectives from desired outcomes (DO-XX). Each plan's objective should trace to at least one desired outcome. Include intent.outcome_ids in PLAN.md frontmatter.
```

3. **Step 1 (Initialize)** — Update the Parse line to include `intent_summary` and `intent_path` from INIT JSON (these are now available from Plan 16-01). No code change needed — just document that these fields exist so the workflow knows to use them.

**Key principle:** All additions are conditional — "if INTENT.md exists" / "if intent_path is non-null". Projects without INTENT.md work exactly as before. No new required fields.
  </action>
  <verify>
Read each modified file and verify:
1. research-phase.md has INTENT.md in files_to_read
2. plan-phase.md has INTENT.md in both researcher and planner spawn prompts
3. plan-phase.md Step 1 mentions intent_summary and intent_path
4. All additions are conditional (check for "if exists" / "if absent" language)
5. No existing functionality removed or broken
  </verify>
  <done>Research and planning workflows include INTENT.md context. Researchers scope exploration to project intent. Planners derive objectives from desired outcomes. All additions are conditional — missing INTENT.md changes nothing.</done>
</task>

<task type="auto">
  <name>Task 2: Add intent-aware verification to verify-work and verify-phase</name>
  <files>workflows/verify-work.md, workflows/verify-phase.md</files>
  <action>
**workflows/verify-work.md** — Modify the `extract_tests` step to include intent-based tests:

Currently extract_tests says: "From SUMMARYs, parse accomplishments and user-facing changes."

Add after that instruction:
```
Also read .planning/INTENT.md if it exists. For each desired outcome (DO-XX) relevant to this phase's requirements:
- Create a test verifying the outcome is observable (e.g., "DO-02: AI agents see intent" → test that init output includes intent data)
- Mark these tests with "[Intent]" prefix in the test name to distinguish from accomplishment-based tests
- Only include outcomes that map to this phase (cross-reference with ROADMAP requirements or intent trace)

Intent-based tests check "did we achieve what we intended?" vs accomplishment-based tests which check "does what we built work?"
```

Also in the `complete_session` step, add:
```
If intent-based tests were included: report intent outcome coverage alongside pass/fail counts.
```

**workflows/verify-phase.md** — Modify the `establish_must_haves` step to incorporate intent:

Add a new **Option D** (intent-based):
```
**Option D — INTENT.md desired outcomes** (if INTENT.md exists):
Read .planning/INTENT.md. For outcomes relevant to this phase:
- Each relevant outcome becomes a truth to verify
- Success criteria (SC-XX) become additional verification gates
- Merge with Option A/B/C truths (intent adds, doesn't replace)
```

Also in the `verify_truths` step, add:
```
For intent-derived truths: verification should check that the desired outcome is observably achieved,
not just that code exists. Example: "AI agents see intent" requires checking init output, not just
that intent.js has a function.
```

**Key principle:** Intent-based verification ADDS to existing verification — it never replaces requirement-based or must_haves-based verification. It's a higher-level "did we achieve what we intended?" check layered on top.
  </action>
  <verify>
Read each modified file and verify:
1. verify-work.md extract_tests step mentions INTENT.md and desired outcomes
2. verify-work.md includes "[Intent]" prefix convention for intent tests
3. verify-phase.md has Option D for intent-based truth derivation
4. verify-phase.md verify_truths mentions intent-derived truth handling
5. All additions are additive (don't remove or modify existing options)
6. All additions are conditional ("if INTENT.md exists")
  </verify>
  <done>Verify-work generates tests from desired outcomes alongside accomplishments. Verify-phase derives truths from intent outcomes. Both are additive and conditional — projects without INTENT.md see zero changes.</done>
</task>

</tasks>

<verification>
- All 4 workflow files modified with intent injection points
- grep for "INTENT.md" in each modified file confirms presence
- All modifications are conditional (no hard dependency on INTENT.md existing)
- No existing workflow steps removed or altered in meaning
- deploy.sh would propagate changes to ~/.config/opencode/ (don't run deploy yet)
</verification>

<success_criteria>
Every major GSD workflow (research, plan, verify-work, verify-phase) includes intent context. Agents receiving these workflow prompts will see and use INTENT.md data when available. The intent system is fully wired into the workflow pipeline.
</success_criteria>

<output>
After completion, create `.planning/phases/16-workflow-integration-self-application/16-03-SUMMARY.md`
</output>
