---
phase: 17-intent-enhancement
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - workflows/new-project.md
  - workflows/new-milestone.md
autonomous: true
requirements: [ICAP-05]
intent:
  outcome_ids: [DO-01, DO-06]
  rationale: "Guided questionnaire ensures every project captures intent from day one (DO-01) and milestone transitions capture evolving intent (DO-06)"

must_haves:
  truths:
    - "New-project workflow asks guided questions about objective, desired outcomes, and success criteria before proceeding to requirements"
    - "New-milestone workflow asks guided questions about intent changes before proceeding to requirements"
    - "Both workflows produce an INTENT.md via intent create with the captured answers"
    - "Questionnaire is skipped in --auto mode (extracted from document instead)"
  artifacts:
    - path: "workflows/new-project.md"
      provides: "Intent questionnaire step between PROJECT.md creation and requirements gathering"
      contains: "intent"
    - path: "workflows/new-milestone.md"
      provides: "Intent evolution questionnaire before requirements gathering"
      contains: "intent"
  key_links:
    - from: "workflows/new-project.md"
      to: "intent create"
      via: "Workflow calls intent create with structured data from questionnaire answers"
      pattern: "intent create"
    - from: "workflows/new-milestone.md"
      to: "intent update"
      via: "Workflow calls intent update for evolved sections, intent create if first milestone"
      pattern: "intent (create|update)"
---

<objective>
Inject guided intent questionnaires into new-project and new-milestone workflows so every project captures structured intent from day one, and milestone transitions explicitly consider how intent has evolved.

Purpose: Enables ICAP-05 (guided intent capture). Currently, intent must be created separately via `intent create`. After this plan, intent capture is woven into the natural project setup flow — users answer questions about purpose, outcomes, and success criteria as part of project initialization.
Output: Updated workflow markdown files with intent questionnaire steps.
</objective>

<execution_context>
@__OPENCODE_CONFIG__/get-shit-done/workflows/execute-plan.md
@__OPENCODE_CONFIG__/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/INTENT.md
@.planning/REQUIREMENTS.md
@workflows/new-project.md
@workflows/new-milestone.md
@templates/intent.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add intent questionnaire to new-project workflow</name>
  <files>workflows/new-project.md</files>
  <action>
Add a new **Step 4.5: Capture Project Intent** between the existing Step 4 (Write PROJECT.md) and Step 5 (Workflow Preferences). This step runs AFTER PROJECT.md is written (so we know the project context) but BEFORE requirements (so intent guides requirements).

**Step 4.5: Capture Project Intent**

```markdown
## 4.5. Capture Project Intent

**Auto mode:** Extract intent from the idea document — synthesize objective, desired outcomes (3-5), and success criteria (2-4) from the document's goals and requirements. Create INTENT.md directly without asking questions.

**Interactive mode:**

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 GSD ► DEFINING INTENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Ask 4 guided questions to extract structured intent. Use PROJECT.md context to make questions specific to the user's project.

**Q1 — Objective:** "In one sentence, what does this project do and why does it matter?"
- Probe: "What problem does it solve? Who suffers without it?"
- Maps to: `<objective>` section

**Q2 — Desired Outcomes:** "What are the 3-5 most important things this project must achieve?"
- Probe: "If this project succeeds, what's different? What can users do that they couldn't before?"
- Prompt for prioritization: "Which of these are critical (P1), important (P2), or nice-to-have (P3)?"
- Maps to: `<outcomes>` section (format: `DO-XX [PX]: description`)

**Q3 — Success Criteria:** "How will you know this project is ready to ship?"
- Probe: "What's the minimum bar? What tests would you run to prove it works?"
- Maps to: `<criteria>` section (format: `SC-XX: measurable gate`)

**Q4 — Constraints:** "Are there any hard limits — technical, business, or timeline?"
- Probe: "Must-use technologies? Budget caps? Deadlines? Backward compatibility?"
- Maps to: `<constraints>` section

Also derive:
- `<users>` from PROJECT.md target users / audience (already captured in deep questioning)
- `<health>` metrics from success criteria where measurable numbers exist

Write INTENT.md using `intent create` with the structured data from answers:

```bash
node __OPENCODE_CONFIG__/get-shit-done/bin/gsd-tools.cjs intent create --raw
```

Note: `intent create` reads from stdin when no arguments provided — pipe the structured intent data to it. Alternatively, write INTENT.md directly using the Write tool following the INTENT.md template format, then commit.

```bash
node __OPENCODE_CONFIG__/get-shit-done/bin/gsd-tools.cjs commit "docs: capture project intent" --files .planning/INTENT.md
```

Present intent summary:
```
✓ Intent captured:
  Objective: {truncated objective}
  Outcomes: {count} ({P1 count}×P1, {P2 count}×P2, {P3 count}×P3)
  Criteria: {count} success gates
  Constraints: {count} limits
```
```

**Update Step 7 (Define Requirements)** to reference intent:

Add to the beginning of Step 7:
```markdown
If INTENT.md exists: Read it and use desired outcomes to seed requirement categories. Each P1/P2 outcome should map to at least one requirement.
```

**Update Step 8 (Create Roadmap)** — add INTENT.md to the roadmapper's files_to_read:
```markdown
- .planning/INTENT.md (if exists)
```

**Update Step 9 (Done)** — add INTENT.md to the artifact table:
```markdown
| Intent         | `.planning/INTENT.md`     |
```

**Update success_criteria** — add:
```markdown
- [ ] INTENT.md captures project intent (objective, outcomes, criteria) → committed
```
  </action>
  <verify>
Read `workflows/new-project.md` and verify:
1. Step 4.5 exists between Steps 4 and 5
2. Auto mode synthesizes from document, interactive mode asks 4 questions
3. INTENT.md creation uses `intent create` or direct Write + commit
4. Step 7 references intent for requirement seeding
5. Step 8 passes INTENT.md to roadmapper
6. Step 9 artifact table includes INTENT.md
7. Success criteria includes INTENT.md
  </verify>
  <done>
New-project workflow asks 4 guided questions (objective, outcomes, criteria, constraints) to capture structured intent before requirements gathering. Auto mode extracts intent from idea document. INTENT.md is committed as part of project setup and feeds into requirements and roadmap creation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add intent evolution questionnaire to new-milestone workflow</name>
  <files>workflows/new-milestone.md</files>
  <action>
Add a new **Step 4.5: Review and Evolve Intent** between the existing Step 4 (Update PROJECT.md) and Step 5 (Update STATE.md). This step handles intent for subsequent milestones.

**Step 4.5: Review and Evolve Intent**

```markdown
## 4.5. Review and Evolve Intent

**If INTENT.md does NOT exist:**
Follow the same questionnaire as new-project Step 4.5 — ask Q1-Q4, create INTENT.md, commit.

**If INTENT.md exists:**

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 GSD ► REVIEWING INTENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Display current intent summary (compact):

```bash
node __OPENCODE_CONFIG__/get-shit-done/bin/gsd-tools.cjs intent show
```

Then ask guided questions about intent evolution:

**Q1 — Objective check:** "Does the project objective still hold for this milestone, or has it shifted?"
- If shifted: capture new objective, `intent update objective --value "..." --reason "..."` 

**Q2 — Outcomes review:** "Looking at your desired outcomes, which are now complete, which still apply, and are there new ones for this milestone?"
- Present each outcome with its priority
- For completed outcomes: "Mark as achieved or keep for ongoing tracking?"
- For new outcomes: "What should this milestone accomplish that wasn't in scope before?"
- Apply changes: `intent update outcomes --value "..." --reason "Milestone vX.Y: {explanation}"`

**Q3 — Criteria evolution:** "Do your success criteria need updating for the new scope?"
- If yes: `intent update criteria --value "..." --reason "..."`

**Q4 — Constraints check:** "Any new constraints or relaxed ones?"
- If yes: `intent update constraints --value "..." --reason "..."`

All updates use the `--reason` flag to capture why the change was made, automatically logging to the `<history>` section.

```bash
node __OPENCODE_CONFIG__/get-shit-done/bin/gsd-tools.cjs commit "docs: evolve intent for milestone v[X.Y]" --files .planning/INTENT.md
```

Present evolution summary:
```
✓ Intent reviewed for v[X.Y]:
  Changes: {N} modifications ({types summary})
  Objective: {unchanged|updated}
  Outcomes: {added N, modified N, removed N}
```

If no changes: `✓ Intent unchanged — carrying forward to v[X.Y]`
```

**Update Step 9 (Define Requirements)** to reference intent:
Add to the beginning of Step 9:
```markdown
If INTENT.md exists: Use desired outcomes (especially any newly added for this milestone) to guide requirement category selection. New outcomes should generate corresponding requirements.
```

**Update Step 10 (Create Roadmap)** — add INTENT.md to roadmapper's files_to_read:
```markdown
- .planning/INTENT.md (if exists)
```

**Update Step 11 (Done)** — add INTENT.md to artifact table if it was created/modified:
```markdown
| Intent         | `.planning/INTENT.md`     |
```

**Update success_criteria** — add:
```markdown
- [ ] Intent reviewed/created for new milestone → committed (if changed)
```
  </action>
  <verify>
Read `workflows/new-milestone.md` and verify:
1. Step 4.5 exists between Steps 4 and 5
2. If no INTENT.md: creates one with questionnaire
3. If INTENT.md exists: reviews each section with guided questions
4. Uses `intent update --reason` for tracked changes
5. Step 9 references intent for requirement seeding
6. Step 10 passes INTENT.md to roadmapper
7. Step 11 artifact table includes INTENT.md
8. Success criteria includes intent
  </verify>
  <done>
New-milestone workflow reviews existing intent or creates new intent before requirements gathering. Each section is reviewed with guided questions, changes use --reason flag for automatic history logging, and the evolved intent feeds into requirements and roadmap creation.
  </done>
</task>

</tasks>

<verification>
1. Workflow structure: Both workflows have intent step between project context and requirements
2. Conditional logic: Auto mode extracts from document, interactive mode asks questions, no-INTENT.md creates fresh
3. Integration: Requirements and roadmap steps reference INTENT.md
4. History integration: new-milestone uses `--reason` flag (from Plan 01) for tracked evolution
5. Backward compatible: Both workflows guard with "if INTENT.md exists" — projects without intent work as before
</verification>

<success_criteria>
- new-project workflow asks 4 guided questions to capture project intent before requirements
- new-project auto mode synthesizes intent from idea document
- new-milestone workflow reviews existing intent section by section with guided evolution questions
- new-milestone creates intent from scratch if INTENT.md missing
- All intent changes during milestone transition use --reason for history tracking
- Requirements and roadmap steps reference intent for seeding/context
- Both workflows are backward compatible — projects without intent see zero changes
</success_criteria>

<output>
After completion, create `.planning/phases/17-intent-enhancement/17-02-SUMMARY.md`
</output>
