---
phase: 14-intent-capture-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 14-01
files_modified:
  - src/commands/intent.js
  - src/router.js
autonomous: true
requirements:
  - ICAP-03
  - ICAP-04

must_haves:
  truths:
    - "intent show renders a compact human-readable summary (one-screen overview)"
    - "intent show --full renders the complete INTENT.md content formatted"
    - "intent show outcomes filters to just that section"
    - "intent read returns parsed JSON (alias for intent show --raw)"
    - "intent read outcomes returns just that section's JSON"
    - "intent update outcomes --add 'description' auto-assigns next DO-XX ID"
    - "intent update outcomes --remove DO-03 removes by ID, preserves ID gaps"
    - "intent update outcomes --set-priority DO-03 P1 changes priority"
    - "intent update increments revision number automatically"
    - "Compact show sorts outcomes by priority (P1 first)"
  artifacts:
    - path: "src/commands/intent.js"
      provides: "Show, read, and update command functions"
      contains: "cmdIntentShow"
    - path: "src/commands/intent.js"
      provides: "Update command with add/remove/set-priority"
      contains: "cmdIntentUpdate"
  key_links:
    - from: "src/commands/intent.js"
      to: "src/lib/helpers.js"
      via: "parseIntentMd for reading, generateIntentMd for writing back"
      pattern: "parseIntentMd|generateIntentMd"
    - from: "src/router.js"
      to: "src/commands/intent.js"
      via: "intent show and intent update routing"
      pattern: "cmdIntentShow|cmdIntentUpdate"
---

<objective>
Implement `intent show`/`intent read` for displaying intent, and `intent update` for modifying specific sections.

Purpose: Complete the read and write side of INTENT.md CRUD. Show provides human-readable output, read provides JSON for agents, update enables granular modifications with ID management.

Output: `cmdIntentShow()` and `cmdIntentUpdate()` in intent.js, router wiring for show/read/update subcommands.
</objective>

<execution_context>
@__OPENCODE_CONFIG__/get-shit-done/workflows/execute-plan.md
@__OPENCODE_CONFIG__/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-intent-capture-foundation/14-CONTEXT.md
@.planning/phases/14-intent-capture-foundation/14-01-SUMMARY.md
@.planning/codebase/CONVENTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: intent show and intent read commands</name>
  <files>
    src/commands/intent.js
    src/router.js
  </files>
  <action>
**Add `cmdIntentShow(cwd, args, raw)` to `src/commands/intent.js`:**

1. Read `.planning/INTENT.md`, error if not found ("No INTENT.md found. Run `intent create` first.")
2. Parse with `parseIntentMd(content)`
3. Check for section filter: `args[1]` can be a section alias (`objective`, `users`, `outcomes`, `criteria`, `constraints`, `health`)
4. If `--raw` flag OR invoked as `intent read`: output parsed JSON
   - With section filter: output just that section's data (e.g., `{outcomes: [{id, priority, text}]}`)
   - Without filter: output full parsed JSON with metadata `{revision, created, updated, objective, users, outcomes, criteria, constraints, health}`
5. If NOT raw (human-readable `intent show`):
   - **Default (compact summary)** — target 10-20 lines, agent-useful density:
     ```
     INTENT — Revision 3 (updated 2026-02-24)

     Objective: [statement, truncated to ~80 chars if needed]

     Outcomes (6): 2×P1  3×P2  1×P3
       P1: DO-01 — [text]
       P1: DO-04 — [text]
       P2: DO-02 — [text]
       ...

     Success Criteria: 4 defined
     Constraints: 2 technical, 1 business, 0 timeline
     Health Metrics: 3 quantitative, qualitative defined
     Target Users: 2 audiences
     ```
   - Sort outcomes by priority (P1 first, then P2, then P3) per user decision
   - **With `--full` flag:** Render complete INTENT.md content in formatted markdown
   - **With section filter (`intent show outcomes`):** Show just that section's full content
6. Color support: P1 in ANSI red, P2 in yellow, P3 in dim — but ONLY when stdout is a TTY (check `process.stdout.isTTY`). Plain output when piped.

**`intent read` alias:**
In the router, wire `intent read` to call `cmdIntentShow(cwd, args, true)` — i.e., force `raw=true`. This makes `read` syntactic sugar for `show --raw` per user decision. If `intent read outcomes` is called, pass the section filter through.

**Router updates:**
- `intent show` → `cmdIntentShow(cwd, args, raw)`
- `intent read` → `cmdIntentShow(cwd, args, true)` (force raw)

Run `npm run build` after implementation.
  </action>
  <verify>
Run `npm run build` — succeeds.
Create test project with INTENT.md (use `intent create` then manually add some outcomes).
Run `node bin/gsd-tools.cjs intent show` — compact summary renders.
Run `node bin/gsd-tools.cjs intent show --full` — full content renders.
Run `node bin/gsd-tools.cjs intent show outcomes` — just outcomes section.
Run `node bin/gsd-tools.cjs intent read --raw` — JSON output.
Run `node bin/gsd-tools.cjs intent read outcomes --raw` — just outcomes JSON.
  </verify>
  <done>
`intent show` renders compact summary with priority-sorted outcomes. `intent show --full` renders complete content. Section filtering works. `intent read` returns JSON. Color output on TTY, plain when piped.
  </done>
</task>

<task type="auto">
  <name>Task 2: intent update command with granular operations</name>
  <files>
    src/commands/intent.js
    src/router.js
  </files>
  <action>
**Add `cmdIntentUpdate(cwd, args, raw)` to `src/commands/intent.js`:**

1. Read `.planning/INTENT.md`, error if not found
2. Parse with `parseIntentMd(content)`
3. Extract section alias from args: `args[1]` = one of `objective`, `users`, `outcomes`, `criteria`, `constraints`, `health`
4. Error if no section specified: "Usage: intent update <section> [--add|--remove|--set-priority] [value]"

**Section-level replace (default mode):**
If called as `intent update objective --value 'New objective statement'`:
- Replace the entire section content with the provided value
- Works for all sections

**Granular item operations (--add, --remove, --set-priority):**

`--add` flag:
- `intent update outcomes --add 'Users can export data'` → auto-assign next ID
  - Scan existing outcome IDs, find max number, assign `DO-{max+1}`
  - Default priority P2 unless specified: `--add 'text' --priority P1`
- `intent update criteria --add 'All tests pass'` → auto-assign `SC-{max+1}`
- `intent update constraints --add 'Must use PostgreSQL' --type technical` → auto-assign `C-{max+1}`, place under `### Technical`
  - `--type` defaults to `technical` if not specified
- `intent update health --add 'Response time <200ms'` → auto-assign `HM-{max+1}` under `### Quantitative`
- `intent update users --add 'DevOps engineers'` → append to bullet list (no IDs)

`--remove` flag:
- `intent update outcomes --remove DO-03` → remove by ID only
- Silent removal — no error if ID not found (idempotent)
- ID gaps preserved — remaining items NOT renumbered per user decision

`--set-priority` flag (outcomes only):
- `intent update outcomes --set-priority DO-03 P1` → change priority of DO-03
- Error if used on non-outcomes section: "--set-priority is only valid for outcomes"
- Error if ID not found: "Outcome DO-03 not found"

**After any update:**
1. Increment revision number: `data.revision += 1`
2. Update timestamp: `data.updated = currentTimestamp()`
3. Regenerate file with `generateIntentMd(data)`
4. Write to disk
5. Auto-commit if `commit_docs` enabled with descriptive message:
   - `docs(intent): add DO-05 to outcomes`
   - `docs(intent): remove SC-02 from criteria`
   - `docs(intent): update objective`
   - `docs(intent): set DO-03 priority to P1`
6. Output result: `{ updated: true, section: 'outcomes', operation: 'add', id: 'DO-05', revision: 4 }`

**Router updates:**
- `intent update` → `cmdIntentUpdate(cwd, args, raw)`

Run `npm run build` after implementation.
  </action>
  <verify>
Run `npm run build` — succeeds.
Test sequence in a temp project:
1. `intent create` → creates INTENT.md (revision 1)
2. `intent update outcomes --add 'Users can log in' --priority P1` → adds DO-01, revision 2
3. `intent update outcomes --add 'Users can export data'` → adds DO-02 (default P2), revision 3
4. `intent show` → shows 2 outcomes, P1 first
5. `intent update outcomes --remove DO-01` → removes, revision 4
6. `intent update outcomes --add 'Users can search'` → adds DO-03 (not DO-02!), revision 5
7. `intent read outcomes --raw` → JSON shows DO-02 and DO-03 (gap at DO-01)
8. `intent update outcomes --set-priority DO-02 P1` → changes priority, revision 6
9. `intent update objective --value 'A tool for managing projects'` → replaces objective, revision 7
  </verify>
  <done>
`intent update` supports section-level replace and granular add/remove/set-priority. Auto-assigns IDs, preserves ID gaps on removal, increments revision, auto-commits with descriptive messages.
  </done>
</task>

</tasks>

<verification>
- `intent show` renders compact summary with priority sorting
- `intent read` returns structured JSON
- Section filtering works for both show and read
- `intent update` with --add auto-assigns correct next ID
- `intent update` with --remove preserves ID gaps
- `intent update` with --set-priority changes priority for outcomes only
- Revision auto-increments on every update
- Auto-commits with descriptive messages
</verification>

<success_criteria>
- All show/read/update subcommands functional
- JSON output clean and structured
- Compact show is 10-20 lines, agent-useful
- ID management handles gaps correctly
- Revision tracking works across updates
- Build succeeds, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/14-intent-capture-foundation/14-02-SUMMARY.md`
</output>
