---
phase: 42-integration-validation
plan: 02
type: execute
wave: 2
depends_on: [42-01]
files_modified: []
autonomous: true
requirements: []
user_setup: []

must_haves:
  truths:
    - "Token savings measured and documented vs v6.0 baseline"
    - "All tests pass (574+ existing + new contract tests)"
    - "Bundle size within 1000KB budget"
  artifacts:
    - path: ".planning/baselines/token-measurement.json"
      provides: "Token counts for v6.0 baseline and v7.0 measurement"
    - path: "test-results.txt"
      provides: "Test suite results showing all pass"
  key_links: []
---

<objective>
Measure token savings vs v6.0 baseline, run all tests, and verify bundle size is within budget.

Purpose: Validates success criteria 2 (token savings), 3 (tests pass), and 5 (bundle size)
Output: Token measurement data, test results, bundle size
</objective>

<execution_context>
@/home/cam/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/42-integration-validation/42-CONTEXT.md (token measurement approach)
@.planning/phases/42-integration-validation/42-RESEARCH.md (token measurement details)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Measure Token Savings vs v6.0 Baseline</name>
  <files>.planning/baselines/token-measurement.json</files>
  <action>
    Measure token consumption for key commands comparing v6.0 vs v7.0:

    **Step 1: Establish v6.0 baseline**
    ```bash
    # Save current branch
    CURRENT_BRANCH=$(git branch --show-current)
    
    # Checkout v6.0 tag
    git checkout v6.0 2>/dev/null || git checkout $(git rev-list --max-count=1 v6.0)
    
    # Measure key command outputs (character count as approximation if tokenizer unavailable)
    node bin/gsd-tools.cjs init execute-phase 42 --raw > /tmp/v6-init-42.txt
    node bin/gsd-tools.cjs init execute-phase 42 --agent=gsd-executor --raw > /tmp/v6-init-42-executor.txt
    node bin/gsd-tools.cjs init execute-phase 42 --agent=gsd-reviewer --raw > /tmp/v6-init-42-reviewer.txt
    
    # Return to current branch
    git checkout $CURRENT_BRANCH
    ```

    **Step 2: Measure v7.0**
    ```bash
    node bin/gsd-tools.cjs init execute-phase 42 --raw > /tmp/v7-init-42.txt
    node bin/gsd-tools.cjs init execute-phase 42 --agent=gsd-executor --raw > /tmp/v7-init-42-executor.txt
    node bin/gsd-tools.cjs init execute-phase 42 --agent=gsd-reviewer --raw > /tmp/v7-init-42-reviewer.txt
    ```

    **Step 3: Count tokens (use tiktoken if available, else chars/4)**
    Create .planning/baselines/token-measurement.json with:
    - v6.0 baseline token counts per command
    - v7.0 token counts per command  
    - Percentage reduction per command
    - Overall reduction percentage
    
    Per CONTEXT.md: Documenting measured token results counts as passing, even if below 30%
  </action>
  <verify>
    .planning/baselines/token-measurement.json exists with v6.0 and v7.0 measurements
  </verify>
  <done>Token measurement data collected - v6.0 baseline and v7.0 measurements recorded with reduction percentages</done>
</task>

<task type="auto">
  <name>Task 2: Run Full Test Suite</name>
  <files>test-results.txt</files>
  <action>
    Run the complete test suite:
    
    ```bash
    npm test 2>&1 | tee test-results.txt
    ```
    
    Per CONTEXT.md: All existing tests (574+) plus new contract tests must pass.
    Per RESEARCH.md: Run specific categories to validate v7.0 features:
    - Contract tests (--grep contract)
    - Git features (--grep git)
    - AST features (--grep ast|codebase)
    - Orchestration (--grep orchest|classify)
    - Context (--grep context|agent)
    - Review (--grep review)
    - TDD (--grep tdd)
  </action>
  <verify>
    ```bash
    # Check test results
    npm test 2>&1 | tail -5
    ```
    Exit code 0, all tests pass
  </verify>
  <done>All tests pass - 574+ existing tests + new contract tests + feature tests</done>
</task>

<task type="auto">
  <name>Task 3: Verify Bundle Size Within Budget</name>
  <files>build-output.txt</files>
  <action>
    Build the bundle and check size:
    
    ```bash
    npm run build 2>&1 | tee build-output.txt
    ls -la bin/gsd-tools.cjs
    ```
    
    Per CONTEXT.md: Bundle must stay within 1000KB budget.
    Extract actual bundle size from build output.
  </action>
  <verify>
    Bundle size <= 1000KB (check ls -la output)
  </verify>
  <done>Bundle size measured - within 1000KB budget</done>
</task>

</tasks>

<verification>
Token measurement data exists
All tests pass (check test-results.txt)
Bundle size within 1000KB
</verification>

<success_criteria>
- Measurable token savings (>=30%) vs v6.0 baselines (documented)
- All tests pass
- Bundle remains within 1000KB budget
</success_criteria>

<output>
After completion, create `.planning/phases/42-integration-validation/{phase}-02-SUMMARY.md`
</output>
