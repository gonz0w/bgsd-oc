---
phase: 36-integration-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/gsd-velocity.md
  - commands/gsd-codebase-impact.md
  - commands/gsd-context-budget.md
  - commands/gsd-rollback-info.md
  - commands/gsd-search-decisions.md
  - commands/gsd-search-lessons.md
  - commands/gsd-session-diff.md
  - commands/gsd-test-run.md
  - commands/gsd-trace-requirement.md
  - commands/gsd-validate-config.md
  - commands/gsd-validate-deps.md
  - deploy.sh
autonomous: true
requirements: [INTG-01, INTG-02, QUAL-03]
outcome_ids: [DO-14]

must_haves:
  truths:
    - "11 command wrapper files exist in commands/ directory with gsd-* naming"
    - "deploy.sh copies commands/ to ~/.config/opencode/command/ during deployment"
    - "deploy.sh does not delete or overwrite non-GSD commands in the target directory"
    - "npm run build succeeds with bundle size under budget"
  artifacts:
    - path: "commands/gsd-velocity.md"
      provides: "Velocity command wrapper"
    - path: "commands/gsd-codebase-impact.md"
      provides: "Codebase impact command wrapper"
    - path: "commands/gsd-context-budget.md"
      provides: "Context budget command wrapper"
    - path: "commands/gsd-rollback-info.md"
      provides: "Rollback info command wrapper"
    - path: "commands/gsd-search-decisions.md"
      provides: "Search decisions command wrapper"
    - path: "commands/gsd-search-lessons.md"
      provides: "Search lessons command wrapper"
    - path: "commands/gsd-session-diff.md"
      provides: "Session diff command wrapper"
    - path: "commands/gsd-test-run.md"
      provides: "Test run command wrapper"
    - path: "commands/gsd-trace-requirement.md"
      provides: "Trace requirement command wrapper"
    - path: "commands/gsd-validate-config.md"
      provides: "Validate config command wrapper"
    - path: "commands/gsd-validate-deps.md"
      provides: "Validate deps command wrapper"
    - path: "deploy.sh"
      provides: "Updated deployment with commands/ sync"
      contains: "commands/"
  key_links:
    - from: "deploy.sh"
      to: "commands/"
      via: "cp -r commands to opencode command dir"
      pattern: "cp.*commands"
    - from: "commands/gsd-*.md"
      to: "workflows/cmd-*.md"
      via: "wrapper referencing workflow"
      pattern: "execution_context"
---

<objective>
Create commands/ directory with 11 command wrappers, update deploy.sh to sync them, and validate build.

Purpose: Wire all 11 feature commands as slash commands in OpenCode (INTG-01, INTG-02) and confirm build stays healthy (QUAL-03).
Output: 11 command wrapper files in commands/, updated deploy.sh, deleted workflows/cmd-*.md originals.
</objective>

<execution_context>
@__OPENCODE_CONFIG__/get-shit-done/workflows/execute-plan.md
@__OPENCODE_CONFIG__/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/INTENT.md
@.planning/phases/36-integration-polish/36-CONTEXT.md
@deploy.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create commands/ directory and move/rename 11 command wrappers</name>
  <files>
    commands/gsd-velocity.md
    commands/gsd-codebase-impact.md
    commands/gsd-context-budget.md
    commands/gsd-rollback-info.md
    commands/gsd-search-decisions.md
    commands/gsd-search-lessons.md
    commands/gsd-session-diff.md
    commands/gsd-test-run.md
    commands/gsd-trace-requirement.md
    commands/gsd-validate-config.md
    commands/gsd-validate-deps.md
  </files>
  <action>
    1. Create `commands/` directory in repo root.

    2. For each of the 11 `workflows/cmd-*.md` files, create a corresponding `commands/gsd-*.md` wrapper. Use the same format as existing installed commands (e.g., `~/.config/opencode/command/gsd-progress.md`):

    ```
    ---
    description: {one-line description from the cmd file}
    tools:
      read: true
      bash: true
      grep: true
      glob: true
    ---
    <objective>
    {objective from the cmd file}
    </objective>

    <execution_context>
    @__OPENCODE_CONFIG__/get-shit-done/workflows/cmd-{name}.md
    </execution_context>

    <process>
    Execute the workflow from the execution_context end-to-end.
    </process>
    ```

    The mapping (workflows/cmd-*.md → commands/gsd-*.md):
    - cmd-velocity.md → gsd-velocity.md
    - cmd-codebase-impact.md → gsd-codebase-impact.md
    - cmd-context-budget.md → gsd-context-budget.md
    - cmd-rollback-info.md → gsd-rollback-info.md
    - cmd-search-decisions.md → gsd-search-decisions.md
    - cmd-search-lessons.md → gsd-search-lessons.md
    - cmd-session-diff.md → gsd-session-diff.md
    - cmd-test-run.md → gsd-test-run.md
    - cmd-trace-requirement.md → gsd-trace-requirement.md
    - cmd-validate-config.md → gsd-validate-config.md
    - cmd-validate-deps.md → gsd-validate-deps.md

    3. Read each `workflows/cmd-*.md` file to extract description and objective for the wrapper. Keep the workflow files in `workflows/` — the command wrappers reference them via `@execution_context`.

    4. Do NOT delete `workflows/cmd-*.md` yet — the wrappers point to them. They stay as workflow definitions.

    Note: Per CONTEXT.md the user initially wanted to move cmd files, but since wrappers reference workflows via @path, the cmd-*.md files must remain in workflows/ as the actual workflow content. The commands/ dir contains thin wrappers only (matching the pattern of all 30 existing installed commands).
  </action>
  <verify>
    - `ls commands/gsd-*.md | wc -l` returns 11
    - Each file contains `execution_context` referencing the corresponding workflow
    - Each file has valid YAML frontmatter with `description` and `tools`
  </verify>
  <done>11 command wrapper files exist in commands/ directory, each with proper frontmatter and execution_context pointing to the workflow file in workflows/</done>
</task>

<task type="auto">
  <name>Task 2: Update deploy.sh to sync commands/ and validate build</name>
  <files>deploy.sh</files>
  <action>
    1. Update `deploy.sh` Step 3 (copy files section) to also copy command wrappers to the OpenCode command directory:

    After the existing `cp` lines, add:
    ```bash
    # Step 3b: Deploy command wrappers (only our commands, don't touch others)
    for cmd in "$SRC/commands"/gsd-*.md; do
      [ -f "$cmd" ] && cp "$cmd" "$HOME/.config/opencode/command/"
    done
    ```

    This approach:
    - Only copies files from our commands/ dir (ours, not others')
    - Does NOT delete or overwrite non-GSD commands (per CONTEXT.md decision)
    - Uses a loop to copy individual files rather than `cp -r` which would create a subdirectory

    2. Also back up the command directory alongside the existing get-shit-done backup (per CONTEXT.md):
    ```bash
    # Back up command directory
    CMD_BACKUP="$HOME/.config/opencode/command.bak-$(date +%Y%m%d-%H%M%S)"
    cp -r "$HOME/.config/opencode/command" "$CMD_BACKUP" 2>/dev/null || true
    ```

    3. Add command wrapper validation to the smoke test section — check that at least one gsd-*.md file was deployed:
    ```bash
    CMD_COUNT=$(ls "$HOME/.config/opencode/command"/gsd-*.md 2>/dev/null | wc -l)
    echo "  Commands deployed: $CMD_COUNT"
    ```

    4. Run `npm run build` to confirm bundle size stays under budget (QUAL-03). The build already has a size budget check built in (681KB / 1000KB).

    5. Run `npm test` to confirm no regressions.
  </action>
  <verify>
    - `npm run build` succeeds with bundle under 1000KB
    - `npm test` passes all tests
    - `grep -c 'commands' deploy.sh` shows the new commands/ handling
    - `bash -n deploy.sh` confirms valid shell syntax
  </verify>
  <done>deploy.sh syncs command wrappers to ~/.config/opencode/command/ during deployment, backs up command dir, build passes, tests pass</done>
</task>

</tasks>

<verification>
- 11 files in commands/ directory with gsd-* naming
- deploy.sh handles commands/ sync without touching non-GSD commands
- `npm run build` succeeds under budget
- `npm test` passes
</verification>

<success_criteria>
All 11 command wrappers exist in commands/, deploy.sh syncs them to OpenCode, and build + tests pass cleanly.
</success_criteria>

<output>
After completion, create `.planning/phases/36-integration-polish/36-01-SUMMARY.md`
</output>
