# Milestone v7.0: Agent Orchestration & Efficiency

**Status:** SHIPPED 2026-02-27
**Phases:** 37-44
**Total Plans:** 15

## Overview

Make bGSD the definitive agent orchestrator for building large software — add missing agent roles, improve orchestration intelligence, optimize performance, and reduce context load without losing fidelity.

## Phases

### Phase 37: Foundation & Safety Net

**Goal:** Establish safety net (contract tests, enhanced git, pre-commit checks) that catches regressions before feature work touches output.
**Requirements:** SAFE-01, SAFE-02, GIT-01, GIT-02
**Plans:** 2 plans

- [x] 37-01: Git intelligence (enhanced git.js, CLI commands, pre-commit checks)
- [x] 37-02: Safety net (contract tests, performance profiler)

### Phase 38: AST Intelligence & Repo Map

**Goal:** CLI produces compact code intelligence (signatures, repo map, complexity) that agents consume instead of full file contents.
**Requirements:** AST-01, AST-02, AST-03, AST-04, CTX-01
**Plans:** 2 plans

- [x] 38-01: AST parser with acorn + regex fallback, codebase ast/exports CLI commands
- [x] 38-02: Complexity scoring + repo-map generator

### Phase 39: Orchestration Intelligence

**Goal:** System auto-classifies task complexity and routes to right agent/model without manual selection.
**Requirements:** ORCH-01, ORCH-02, ORCH-03
**Plans:** 1 plan

- [x] 39-01: Task complexity classifier, agent router, execution mode selector, init execute-phase integration

### Phase 40: Context Efficiency

**Goal:** Agent context consumption drops 40-60% via compact serialization, context scoping, and task-scoped injection.
**Requirements:** CTX-02, CTX-03, CTX-04
**Plans:** 2 plans

- [x] 40-01: Agent context manifests + compact serializers for plan state and dep graphs
- [x] 40-02: Task-scoped file injection using dep graph + AST signatures

### Phase 41: Agent Quality Gates

**Goal:** Every execution has a post-review quality gate — separate reviewer checks against conventions.
**Requirements:** QUAL-01, QUAL-02, QUAL-03
**Plans:** 2 plans

- [x] 41-01: Commit attribution via git trailers + review context CLI command
- [x] 41-02: Reviewer agent reference + pipeline integration (execute-plan, verify-phase, summary)

### Phase 42: Integration & Validation

**Goal:** All v7.0 features work end-to-end with measured performance and no canary regressions.
**Requirements:** (validates all prior phases)
**Plans:** 3 plans

- [x] 42-01: Canary cycle: Plan Phase 44 → Execute → Verify
- [x] 42-02: Token measurement, test suite, bundle size validation
- [x] 42-03: Generate validation report with all criterion results

### Phase 43: TDD Execution Engine

**Goal:** Executor follows a strict RED→GREEN→REFACTOR state machine for TDD plans with verification gates, auto test-after-edit, and anti-pattern detection.
**Requirements:** TDD-01, TDD-02, TDD-03, TDD-04, TDD-05, EXEC-01, EXEC-02
**Dependencies:** Phase 41 (reviewer agent, commit attribution)
**Plans:** 2 plans

- [x] 43-01: TDD validation CLI commands (validate-red/green/refactor, auto-test, detect-antipattern) and GSD-Phase commit trailer
- [x] 43-02: TDD execution workflow with orchestrator-enforced gates, auto test-after-edit, anti-pattern reference

### Phase 44: Review Gate Hardening

**Goal:** Graduate reviewer from informational to enforcing — two-stage review (spec + quality), severity-classified findings with blocking, and stuck/loop detection.
**Requirements:** QUAL-04, QUAL-05, QUAL-06
**Dependencies:** Phase 41 (reviewer agent), Phase 43 (TDD execution)
**Plans:** 1 plan

- [x] 44-01: Two-stage review, severity classification, stuck detection

## Milestone Summary

**Key Decisions:**
- Allow dependencies when they serve quality (acorn ~121KB for AST intelligence)
- Hybrid snapshot strategy for contract tests (full for high-value, field-level for others)
- Model mapping scores 1-3 → sonnet, 4-5 → opus
- Agent manifests use whitelist not blacklist for safety
- Intelligence as data, not agents (cap at 12 roles)
- TDD gate validation via execSync with 120s timeout
- Post-execution review non-blocking initially, graduated to blocking for BLOCKER-severity findings
- Stuck/loop detection at 3 failures with automatic recovery

**Issues Resolved:**
- Context rot from unbounded agent context injection — solved by manifests + compact serialization
- No code review agent — solved by gsd-reviewer with two-stage review
- No TDD enforcement — solved by RED-GREEN-REFACTOR state machine
- No automatic test-after-edit — solved by auto-test workflow instruction
- Agent stuck in loops burning tokens — solved by stuck/loop detection

**Issues Deferred:**
- Agent performance tracking (per-agent success/failure rates) — deferred to v7.x
- Conversation compaction via LLM API — deferred to v7.x
- Performance profiler module — deferred to v7.x
- Review fix-and-resubmit loop — deferred to v8.0

---

_For current project status, see .planning/ROADMAP.md_
