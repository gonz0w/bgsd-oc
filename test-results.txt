
> gsd-tools@1.0.0 test
> node --test bin/gsd-tools.test.cjs

▶ history-digest command
  ✔ empty phases directory returns valid schema (83.417217ms)
  ✔ nested frontmatter fields extracted correctly (98.498983ms)
  ✔ multiple phases merged into single digest (137.773436ms)
  ✔ malformed SUMMARY.md skipped gracefully (103.510832ms)
  ✔ flat provides field still works (backward compatibility) (96.441253ms)
  ✔ inline array syntax supported (125.898108ms)
✔ history-digest command (648.711985ms)
▶ phases list command
  ✔ empty phases directory returns empty array (84.836053ms)
  ✔ lists phase directories sorted numerically (91.102091ms)
  ✔ handles decimal phases in sort order (119.001888ms)
  ✔ --type plans lists only PLAN.md files (118.167305ms)
  ✔ --type summaries lists only SUMMARY.md files (118.820473ms)
  ✔ --phase filters to specific phase directory (125.177442ms)
✔ phases list command (658.446562ms)
▶ roadmap get-phase command
  ✔ extracts phase section from ROADMAP.md (121.459276ms)
  ✔ returns not found for missing phase (134.892019ms)
  ✔ handles decimal phase numbers (102.205906ms)
  ✔ extracts full section content (105.141863ms)
  ✔ handles missing ROADMAP.md gracefully (101.566453ms)
  ✔ accepts ## phase headers (two hashes) (106.110148ms)
  ✔ detects malformed ROADMAP with summary list but no detail sections (82.143545ms)
✔ roadmap get-phase command (754.407825ms)
▶ phase next-decimal command
  ✔ returns X.1 when no decimal phases exist (115.168113ms)
  ✔ increments from existing decimal phases (73.413917ms)
  ✔ handles gaps in decimal sequence (108.349438ms)
  ✔ handles single-digit phase input (110.980901ms)
  ✔ returns error if base phase does not exist (83.566012ms)
✔ phase next-decimal command (492.225873ms)
▶ phase-plan-index command
  ✔ empty phase directory returns empty plans array (118.143838ms)
  ✔ extracts single plan with frontmatter (145.910509ms)
  ✔ groups multiple plans by wave (147.863489ms)
  ✔ detects incomplete plans (no matching summary) (141.879284ms)
  ✔ detects checkpoints (autonomous: false) (132.536711ms)
  ✔ phase not found returns error (103.350505ms)
✔ phase-plan-index command (790.609689ms)
▶ state-snapshot command
  ✔ missing STATE.md returns error (92.166218ms)
  ✔ extracts basic fields from STATE.md (136.916099ms)
  ✔ extracts decisions table (112.50933ms)
  ✔ extracts blockers list (96.533144ms)
  ✔ extracts session continuity info (107.808602ms)
  ✔ handles paused_at field (86.237746ms)
✔ state-snapshot command (632.936892ms)
▶ summary-extract command
  ✔ missing file returns error (85.925672ms)
  ✔ extracts all fields from SUMMARY.md (137.386758ms)
  ✔ selective extraction with --fields (127.562543ms)
  ✔ handles missing frontmatter fields gracefully (158.850989ms)
  ✔ parses key-decisions with rationale (132.978162ms)
✔ summary-extract command (643.496786ms)
▶ init commands
  ✔ init execute-phase returns file paths (143.581994ms)
  ✔ init plan-phase returns file paths (126.876559ms)
  ✔ init progress returns file paths (120.598362ms)
  ✔ init phase-op returns core and optional phase file paths (124.336664ms)
  ✔ init plan-phase omits optional paths if files missing (107.557579ms)
  ✔ init commands return full output with --verbose (111.738576ms)
  ✔ init progress --compact returns essential-only fields (118.523813ms)
  ✔ compact default reduces init output size by at least 38% vs --verbose (2706.39724ms)
  ✔ --compact and --fields can be used together (107.632196ms)
  ✔ all init commands accept --compact without error (1323.787312ms)
  ✔ compact --manifest output includes _manifest with files array (104.826953ms)
  ✔ plan-phase --manifest includes requirements and state (113.883564ms)
  ✔ execute-phase --manifest includes plan files (150.646611ms)
  ✔ --manifest only references files that exist (127.059738ms)
  ✔ non-compact output does not include _manifest (83.608847ms)
  ✔ --compact without --manifest excludes _manifest (108.383102ms)
  ✔ --compact --manifest includes manifest and returns valid output for all commands (1384.846563ms)
✔ init commands (7066.20327ms)
▶ roadmap analyze command
  ✔ missing ROADMAP.md returns error (117.585391ms)
  ✔ parses phases with goals and disk status (97.195998ms)
  ✔ extracts goals and dependencies (104.266115ms)
✔ roadmap analyze command (319.493695ms)
▶ phase add command
  ✔ adds phase after highest existing (113.67775ms)
  ✔ handles empty roadmap (73.247749ms)
✔ phase add command (187.272661ms)
▶ phase insert command
  ✔ inserts decimal phase after target (79.646613ms)
  ✔ increments decimal when siblings exist (96.267885ms)
  ✔ rejects missing phase (77.437755ms)
  ✔ handles padding mismatch between input and roadmap (89.676921ms)
  ✔ handles #### heading depth from multi-milestone roadmaps (128.350205ms)
✔ phase insert command (471.991373ms)
▶ phase remove command
  ✔ removes phase directory and renumbers subsequent (180.386562ms)
  ✔ rejects removal of phase with summaries unless --force (252.168866ms)
  ✔ removes decimal phase and renumbers siblings (95.985971ms)
  ✔ updates STATE.md phase count (125.839618ms)
✔ phase remove command (655.191133ms)
▶ phase complete command
  ✔ marks phase complete and transitions to next (123.067408ms)
  ✔ detects last phase in milestone (153.65178ms)
  ✔ updates REQUIREMENTS.md traceability when phase completes (162.594491ms)
  ✔ handles requirements with bracket format [REQ-01, REQ-02] (112.248112ms)
  ✔ handles phase with no requirements mapping (147.564095ms)
  ✔ handles missing REQUIREMENTS.md gracefully (104.199442ms)
✔ phase complete command (803.992136ms)
▶ milestone complete command
  ✔ archives roadmap, requirements, creates MILESTONES.md (82.698158ms)
  ✔ appends to existing MILESTONES.md (145.799753ms)
✔ milestone complete command (228.724389ms)
▶ validate consistency command
  ✔ passes for consistent project (137.183975ms)
  ✔ warns about phase on disk but not in roadmap (126.760908ms)
  ✔ warns about gaps in phase numbering (97.345918ms)
✔ validate consistency command (361.649687ms)
▶ progress command
  ✔ renders JSON progress (122.969774ms)
  ✔ renders bar format (127.619581ms)
  ✔ renders table format (98.763864ms)
✔ progress command (349.69855ms)
▶ todo complete command
  ✔ moves todo from pending to completed (132.395264ms)
  ✔ fails for nonexistent todo (101.689191ms)
✔ todo complete command (234.368324ms)
▶ scaffold command
  ✔ scaffolds context file (105.026791ms)
  ✔ scaffolds UAT file (91.223642ms)
  ✔ scaffolds verification file (94.584552ms)
  ✔ scaffolds phase directory (149.582962ms)
  ✔ does not overwrite existing files (137.67532ms)
✔ scaffold command (578.62961ms)
▶ state update command
  ✔ updates a single field (Status) (104.162634ms)
  ✔ updates Phase field with complex value (120.920227ms)
  ✔ returns updated: false for nonexistent field (113.856246ms)
✔ state update command (339.200405ms)
▶ state patch command
  ✔ updates multiple fields at once (89.752555ms)
  ✔ reports failed fields that do not exist (107.143038ms)
✔ state patch command (197.114555ms)
▶ state add-decision command
  ✔ appends decision and removes placeholder (85.820104ms)
  ✔ adds second decision without removing first (195.879462ms)
  ✔ returns added: false when section missing (87.157129ms)
✔ state add-decision command (369.234525ms)
▶ state add-blocker command
  ✔ appends blocker and removes placeholder (127.096799ms)
  ✔ returns added: true in JSON output (106.853683ms)
✔ state add-blocker command (234.253206ms)
▶ state resolve-blocker command
  ✔ resolves an existing blocker by text match (233.984115ms)
  ✔ returns resolved: true even for nonexistent blocker (100.38159ms)
  ✔ restores None placeholder when last blocker resolved (158.820128ms)
✔ state resolve-blocker command (493.555158ms)
▶ state record-session command
  ✔ updates all session continuity fields (127.357584ms)
  ✔ returns recorded: true in JSON output (115.404243ms)
✔ state record-session command (243.028048ms)
▶ state advance-plan command
  ✔ advances plan number from 1 to 2 (140.703857ms)
  ✔ detects last plan in phase and sets phase complete (243.899349ms)
  ✔ updates Last Activity date (140.75273ms)
✔ state advance-plan command (525.710329ms)
▶ state record-metric command
  ✔ appends a row to the Performance Metrics table (98.251707ms)
  ✔ returns recorded: true with metric details (107.040127ms)
  ✔ returns error when required fields missing (120.968763ms)
✔ state record-metric command (326.665507ms)
▶ frontmatter round-trip
  ✔ simple key-value pairs round-trip losslessly (360.156718ms)
  ✔ inline arrays round-trip losslessly (310.800975ms)
  ✔ nested objects (2 levels) round-trip losslessly (358.133357ms)
  ✔ quoted strings with colons round-trip losslessly (276.88912ms)
  ✔ empty arrays round-trip losslessly (258.089591ms)
  ✔ boolean and number strings round-trip losslessly (354.194862ms)
  ✔ multi-level nesting (3 levels) round-trips losslessly (326.844395ms)
  ✔ body content is preserved after frontmatter merge (137.392167ms)
✔ frontmatter round-trip (2383.303152ms)
▶ frontmatter edge cases
  ✔ real PLAN.md format with must_haves block round-trips (306.580611ms)
  ✔ array items with nested key-value pairs are stable through round-trips (339.872073ms)
  ✔ values that look like YAML special values stay as strings (345.254567ms)
  ✔ frontmatter-merge adds new keys without removing existing ones (additive merge) (260.862196ms)
  ✔ frontmatter-merge updates existing keys (update merge) (314.594894ms)
✔ frontmatter edge cases (1567.808952ms)
▶ debug logging
  ✔ produces debug output on stderr when GSD_DEBUG=1 (126.686112ms)
  ✔ no debug output when GSD_DEBUG is unset (157.627515ms)
  ✔ stdout JSON remains valid when GSD_DEBUG=1 (88.018723ms)
  ✔ debug output includes context strings with [GSD_DEBUG] prefix (140.892066ms)
✔ debug logging (513.790696ms)
▶ shell sanitization
  ✔ session-diff extracts only the date portion from Last Activity (198.024946ms)
  ✔ session-diff works with valid date strings (152.222409ms)
  ✔ session-diff rejects backtick injection in date (158.043372ms)
  ✔ session-diff rejects $() injection in date (142.265995ms)
  ✔ codebase-impact uses --fixed-strings for grep patterns (135.843782ms)
✔ shell sanitization (787.207538ms)
▶ temp file cleanup
  ✔ process exit handler is registered for temp file cleanup (12.522829ms)
  ✔ _tmpFiles tracking is wired into output pipeline (8.41495ms)
  ✔ no temp files remain after CLI invocation (105.652059ms)
  ✔ exit handler cleans up tracked files (0.332378ms)
✔ temp file cleanup (127.205082ms)
▶ --help flag
  ✔ known command prints help to stderr (120.904275ms)
  ✔ unknown command lists available commands (114.685464ms)
  ✔ help text does not contaminate stdout (76.951987ms)
  ✔ COMMAND_HELP covers major commands (134.088462ms)
✔ --help flag (446.920666ms)
▶ config-migrate command
  ✔ adds missing keys with schema defaults (127.591738ms)
  ✔ existing values are never overwritten (102.387122ms)
  ✔ backup file is created before writing (138.501011ms)
  ✔ already-complete config returns empty migrated_keys (92.681671ms)
  ✔ config-migrate help text available (130.414814ms)
✔ config-migrate command (592.208386ms)
▶ build system
  ✔ npm run build succeeds with exit code 0 (1076.764971ms)
  ✔ build produces bin/gsd-tools.cjs from src/ (583.281302ms)
  ✔ built file has working shebang on line 1 (600.982137ms)
  ✔ built current-timestamp outputs valid ISO format (657.272887ms)
  ✔ built state load works in temp project (656.517695ms)
  ✔ build completes in under 500ms (481.060193ms)
✔ build system (4056.616838ms)
▶ file cache
  ✔ init progress returns valid JSON with cache enabled (166.299135ms)
  ✔ cachedReadFile and invalidateFileCache are exported (10.96801ms)
✔ file cache (177.557676ms)
▶ codebase-impact batch grep
  ✔ returns dependents for a known file (119.877101ms)
  ✔ handles non-existent file (107.197268ms)
  ✔ handles file with no code dependents (102.184198ms)
  ✔ analyzes multiple files in single call (149.129017ms)
  ✔ uses batched grep (source contains -e flag pattern) (3.000765ms)
✔ codebase-impact batch grep (481.901042ms)
▶ codebase-impact graph-first path (WKFL-03)
  ✔ uses cached graph when intel has dependencies (297.149611ms)
  ✔ graph path output format matches expected schema (139.189551ms)
  ✔ graph path handles non-existent file (107.083583ms)
  ✔ graph path handles multiple files (128.895657ms)
✔ codebase-impact graph-first path (WKFL-03) (672.781295ms)
▶ configurable context window
  ✔ context-budget uses default context window (200K) (342.157286ms)
  ✔ context-budget output includes context_window field (259.564033ms)
  ✔ validate-config recognizes context_window as known key (100.67599ms)
  ✔ validate-config recognizes context_target_percent as known key (96.903023ms)
✔ configurable context window (799.66535ms)
▶ --fields flag
  ✔ filters top-level fields from JSON output (161.409992ms)
  ✔ missing fields return null (154.843548ms)
  ✔ without --fields returns full output with --verbose (171.24129ms)
  ✔ dot-notation filters nested object fields (112.268838ms)
  ✔ filterFields function works on arrays (0.650003ms)
  ✔ filterFields function supports dot-notation (0.257008ms)
✔ --fields flag (601.143775ms)
▶ token estimation
  ✔ estimateTokens returns a number for text input (5.388238ms)
  ✔ estimateTokens returns 0 for empty/null input (0.15176ms)
  ✔ estimateJsonTokens works on objects (0.218161ms)
  ✔ checkBudget returns correct structure (0.206532ms)
  ✔ checkBudget warns when over target (0.136468ms)
  ✔ context-budget uses tokenx-based estimates (not lines*4) (276.978867ms)
✔ token estimation (283.424301ms)
▶ extractAtReferences
  ✔ extracts absolute path references (1.32772ms)
  ✔ extracts relative .planning/ references (0.497244ms)
  ✔ extracts references from context blocks (0.333846ms)
  ✔ ignores email addresses and non-path mentions (0.215497ms)
  ✔ deduplicates references (0.213259ms)
  ✔ returns empty array for null/empty input (0.160628ms)
✔ extractAtReferences (3.339928ms)
▶ context-budget baseline
  ✔ baseline output has required fields (176.478791ms)
  ✔ each workflow entry has required measurement fields (190.407364ms)
  ✔ workflows are sorted by total_tokens descending (230.174734ms)
  ✔ baseline file is created in .planning/baselines/ (223.028597ms)
  ✔ context-budget <path> still works (backward compat) (170.394376ms)
✔ context-budget baseline (991.008264ms)
▶ context-budget compare
  ✔ compare with no baseline dir returns error (113.815467ms)
  ✔ compare JSON has required fields (451.029881ms)
  ✔ compare shows zero delta when run immediately after baseline (365.796826ms)
  ✔ compare workflows sorted by delta ascending (biggest reductions first) (319.799806ms)
  ✔ compare with explicit baseline path works (282.566665ms)
  ✔ compare each workflow has required fields (332.974773ms)
✔ context-budget compare (1866.61094ms)
▶ extract-sections command
  ✔ extract-sections lists available sections from markdown file (125.664744ms)
  ✔ extract-sections extracts specific section by header name (101.664978ms)
  ✔ extract-sections handles section markers (HTML comments) (207.164963ms)
  ✔ extract-sections returns sections_missing for unknown sections (117.540055ms)
  ✔ extract-sections handles multiple section extraction (95.621285ms)
  ✔ extract-sections works on real reference files (201.275355ms)
  ✔ extract-sections command is registered and responds (132.535805ms)
✔ extract-sections command (982.18619ms)
▶ state validate
  ✔ clean state returns "clean" status (189.897205ms)
  ✔ detects plan count drift (117.818989ms)
  ✔ detects completion drift (156.927921ms)
  ✔ detects missing position (120.990325ms)
  ✔ detects completed position (100.914357ms)
  ✔ detects stale activity via git (205.238002ms)
  ✔ --fix corrects plan count drift (224.884149ms)
  ✔ no blocker staleness when blockers section is empty (126.982414ms)
  ✔ detects stale blockers after completed plans (149.593462ms)
  ✔ returns error status when both ROADMAP.md and STATE.md are missing (121.616141ms)
  ✔ multiple issue types combine correctly (102.436727ms)
✔ state validate (1618.85241ms)
▶ state validate pre-flight
  ✔ init execute-phase includes pre_flight_validation field (111.995546ms)
  ✔ pre_flight_validation respects config gates.pre_flight_validation: false (127.569217ms)
  ✔ state validate --fix then validate returns clean for plan count drift (389.527836ms)
  ✔ state validate with multiple issue types returns mixed severities (148.357614ms)
  ✔ init execute-phase compact mode includes pre_flight_validation (97.234698ms)
✔ state validate pre-flight (875.244221ms)
▶ memory commands
  ✔ memory list returns empty when no memory dir (148.750068ms)
  ✔ memory write creates directory and file (124.08003ms)
  ✔ memory write appends to existing store (251.332483ms)
  ✔ memory read returns empty for missing store (116.795085ms)
  ✔ memory read with query filter (85.292859ms)
  ✔ memory read with phase filter (125.301647ms)
  ✔ memory read with limit (99.667657ms)
  ✔ bookmarks store trims to max 20 entries (446.615137ms)
  ✔ decisions store never prunes (write 30, read back all 30) (3422.795834ms)
  ✔ memory list shows stats for populated stores (106.506063ms)
✔ memory commands (4928.23336ms)
▶ init memory
  ✔ returns minimal stub when no memory exists (133.227594ms)
  ✔ includes position from STATE.md (118.736285ms)
  ✔ includes decisions from memory store (108.859111ms)
  ✔ filters decisions by phase (92.982216ms)
  ✔ includes latest bookmark (126.975271ms)
  ✔ workflow flag selects codebase sections (315.857796ms)
  ✔ compact mode reduces output vs verbose (234.407435ms)
  ✔ includes blockers from STATE.md (93.997519ms)
✔ init memory (1225.884542ms)
▶ memory compact
  ✔ compact refuses to compact decisions (returns sacred_data) (108.924586ms)
  ✔ compact refuses to compact lessons (returns sacred_data) (104.37415ms)
  ✔ compact trims bookmarks to 10 live + summaries for old entries (122.303771ms)
  ✔ compact with dry-run does not modify files (83.588385ms)
  ✔ compact all stores skips sacred data (128.864627ms)
  ✔ compact todos removes old completed items (146.10132ms)
  ✔ write command warns when todos exceed threshold (88.821415ms)
  ✔ compact with custom threshold (215.35909ms)
✔ memory compact (999.346442ms)
▶ verify analyze-plan
  ✔ scores well-structured plan (2 tasks, shared files) as 4-5 (114.459965ms)
  ✔ scores multi-concern plan (4+ tasks in unrelated dirs) as 1-2 (98.560287ms)
  ✔ detects concern groups correctly (79.035842ms)
  ✔ suggests splits for poor plans (score <= 3) (103.992717ms)
  ✔ handles single-task plan (score 5) (133.777633ms)
  ✔ handles missing file gracefully (147.77129ms)
✔ verify analyze-plan (678.478516ms)
▶ verify deliverables
  ✔ returns structured result when npm test runs (419.959714ms)
  ✔ returns fail when test command fails (315.410531ms)
  ✔ auto-detects test framework from package.json (346.539064ms)
✔ verify deliverables (1082.263145ms)
▶ verify requirements
  ✔ returns all addressed when all reqs marked [x] (148.123862ms)
  ✔ detects unaddressed req when phase has no summaries (122.718826ms)
  ✔ handles missing REQUIREMENTS.md gracefully (126.19271ms)
✔ verify requirements (397.346577ms)
▶ verify regression
  ✔ detects regression when test goes pass to fail (111.005315ms)
  ✔ returns clean when no regressions (125.967118ms)
  ✔ handles missing baseline gracefully (98.881771ms)
✔ verify regression (336.186778ms)
▶ verify plan-wave
  ✔ detects file conflicts within a wave (87.160012ms)
  ✔ returns clean when no conflicts (119.411355ms)
  ✔ handles single-plan phase (126.281764ms)
✔ verify plan-wave (333.13016ms)
▶ verify plan-deps
  ✔ detects dependency cycle (120.123197ms)
  ✔ detects unreachable dependency (151.385497ms)
  ✔ returns clean for valid graph (112.102957ms)
  ✔ detects unnecessary serialization (114.122655ms)
✔ verify plan-deps (498.146217ms)
▶ verify plan-structure template compliance
  ✔ detects missing required frontmatter fields (121.044259ms)
  ✔ validates requirements is non-empty (141.692585ms)
  ✔ returns valid for well-formed plan (100.844858ms)
✔ verify plan-structure template compliance (363.946403ms)
▶ verify quality
  ✔ returns composite score with all dimensions (304.356611ms)
  ✔ grade mapping thresholds are correct (343.080912ms)
  ✔ must-haves checks file existence and scores correctly (310.628741ms)
  ✔ stores score in quality-scores.json (310.149794ms)
  ✔ trend tracking detects improving scores (361.160301ms)
  ✔ handles missing plan gracefully with phase-only (433.705938ms)
✔ verify quality (2063.804932ms)
▶ integration: workflow sequences
  ✔ init → state → roadmap sequence (412.610811ms)
  ✔ state mutation sequence: patch → get (302.844462ms)
  ✔ memory write → read → list sequence (351.441694ms)
  ✔ verify requirements with mixed coverage (123.807902ms)
✔ integration: workflow sequences (1191.446178ms)
▶ integration: state round-trip
  ✔ full state lifecycle: patch fields, get each, add decision (531.208855ms)
  ✔ frontmatter round-trip: get → set → get (342.503339ms)
✔ integration: state round-trip (873.988197ms)
▶ integration: config migration
  ✔ migrates old flat config to modern format (132.794172ms)
  ✔ idempotent on modern config (77.104483ms)
✔ integration: config migration (210.169065ms)
▶ integration: e2e simulation
  ✔ full project lifecycle: init progress → verify plan-structure → verify requirements (410.139872ms)
  ✔ memory lifecycle: write decision → write bookmark → init memory (301.896872ms)
✔ integration: e2e simulation (712.297317ms)
▶ integration: snapshot tests
  ✔ init progress output structure (172.98076ms)
  ✔ init execute-phase output structure (184.784784ms)
  ✔ init plan-phase output structure (159.502373ms)
  ✔ state load output structure (119.330701ms)
✔ integration: snapshot tests (637.002824ms)
▶ test-coverage
  ✔ returns valid structure (149.609975ms)
  ✔ shows non-zero coverage (152.569933ms)
✔ test-coverage (302.464002ms)
▶ build pipeline
  ✔ bundle size is under 1000KB budget (0.536785ms)
  ✔ bundle is valid JavaScript (99.14433ms)
✔ build pipeline (99.956569ms)
▶ token-budget
  ✔ returns budgets with actual token counts for project dir (154.222063ms)
  ✔ all known workflows are within budget (103.958877ms)
✔ token-budget (258.449254ms)
▶ compact default behavior
  ✔ default output is compact (no --compact needed) (169.979748ms)
  ✔ --verbose restores full output (219.862896ms)
✔ compact default behavior (390.080871ms)
▶ intent commands
  ▶ intent create
    ✔ creates INTENT.md with all 6 XML sections in fresh project (175.99877ms)
    ✔ errors if INTENT.md already exists (221.127452ms)
    ✔ --force overwrites existing INTENT.md (219.462438ms)
    ✔ created INTENT.md has Revision 1 (161.573263ms)
  ✔ intent create (778.735431ms)
  ▶ intent show/read
    ✔ intent show --raw returns valid JSON with all section keys (107.136099ms)
    ✔ intent read --raw returns same JSON as intent show --raw (226.386772ms)
    ✔ intent read outcomes --raw returns just outcomes array (95.497419ms)
  ✔ intent show/read (429.379891ms)
  ▶ intent update
    ✔ --add outcome assigns DO-01 with specified priority (166.55187ms)
    ✔ --add second outcome gets next sequential ID (393.09599ms)
    ✔ --remove removes item and subsequent --add preserves gap (692.766647ms)
    ✔ --set-priority changes outcome priority (274.27238ms)
    ✔ --value replaces objective section (249.094858ms)
    ✔ revision increments on each update (316.288014ms)
  ✔ intent update (2092.715929ms)
  ▶ intent validate
    ✔ valid INTENT.md with all sections returns exit code 0 (85.420695ms)
    ✔ INTENT.md with missing section returns exit code 1 (83.671202ms)
    ✔ --raw returns JSON with valid/issues fields (88.825424ms)
  ✔ intent validate (258.420158ms)
  ▶ intent round-trip
    ✔ create → update → show → validate round-trip is consistent (1229.360143ms)
  ✔ intent round-trip (1229.596723ms)
  ▶ intent help
    ✔ intent --help shows subcommand list (109.977851ms)
    ✔ intent validate --help shows validate usage (156.229565ms)
  ✔ intent help (266.495045ms)
  ▶ intent trace
    ✔ trace with no INTENT.md errors (144.219335ms)
    ✔ trace with INTENT.md but no plans returns 0 coverage and all outcomes as gaps (92.182777ms)
    ✔ trace with INTENT.md + plans tracing to outcomes shows correct matrix (98.537286ms)
    ✔ trace --gaps shows only uncovered outcomes (77.113701ms)
    ✔ trace with plan missing intent section includes plan with empty outcome_ids (104.086491ms)
    ✔ trace --raw returns valid JSON with all expected fields (116.609713ms)
    ✔ parsePlanIntent handles comma-separated outcome IDs (146.567767ms)
    ✔ intent trace --help shows trace usage (125.082943ms)
  ✔ intent trace (905.461777ms)
  ▶ intent drift
    ✔ drift with no INTENT.md errors (100.730193ms)
    ✔ drift with INTENT.md but no plans shows score near 100 (124.020842ms)
    ✔ drift with perfect alignment shows score 0 (83.470598ms)
    ✔ drift detects objective mismatch (plan with no intent section) (92.050936ms)
    ✔ drift detects feature creep (plan referencing non-existent DO-99) (122.264424ms)
    ✔ drift detects priority inversion (P1 uncovered while P2 covered) (127.600242ms)
    ✔ drift score within 0-100 range across scenarios (82.606899ms)
    ✔ drift --raw returns valid JSON with all expected fields (108.916979ms)
    ✔ drift alignment labels correct (0-15 excellent, 16-35 good, 36-60 moderate, 61-100 poor) (123.86168ms)
    ✔ pre-flight: init execute-phase intent_drift null when no INTENT.md (184.189638ms)
    ✔ intent drift --help shows drift usage (124.815545ms)
  ✔ intent drift (1275.778266ms)
  ▶ intent summary in init commands
    ✔ getIntentSummary returns null when no INTENT.md (158.286684ms)
    ✔ getIntentSummary returns summary when INTENT.md exists (169.28666ms)
    ✔ init execute-phase includes intent_summary field (151.165442ms)
    ✔ init plan-phase includes intent_summary and intent_path fields (101.176419ms)
    ✔ init plan-phase intent fields absent in compact mode when no INTENT.md (109.811684ms)
  ✔ intent summary in init commands (690.216418ms)
  ▶ intent history
    ✔ parse INTENT.md without history returns empty array (113.258219ms)
    ✔ parse INTENT.md with history returns entries and changes (128.134081ms)
    ✔ update auto-logs history entry (109.361894ms)
    ✔ update with --reason flag records custom reason (143.995689ms)
    ✔ show compact includes evolution line when history exists (90.982351ms)
    ✔ show history section renders evolution (87.604362ms)
    ✔ validate accepts INTENT.md with valid history (110.081322ms)
    ✔ validate works without history (backward compatible) (141.186816ms)
  ✔ intent history (925.47411ms)
✔ intent commands (8853.710934ms)
▶ env scan
  ▶ manifest pattern completeness
    ✔ LANG_MANIFESTS contains at least 15 entries (147.427821ms)
    ✔ scan returns valid JSON with expected schema fields (105.537746ms)
  ✔ manifest pattern completeness (253.344922ms)
  ▶ language detection
    ✔ detects node from package.json (147.531442ms)
    ✔ detects go from go.mod (158.795503ms)
    ✔ detects elixir from mix.exs (2016.625218ms)
    ✔ detects multiple languages in polyglot project (2132.328816ms)
    ✔ detects nested manifest at depth 1 (113.154634ms)
    ✔ does NOT detect files beyond depth 3 (112.134682ms)
    ✔ empty directory returns empty languages array (119.891537ms)
  ✔ language detection (4801.331112ms)
  ▶ primary language detection
    ✔ single language marked as primary (170.711185ms)
    ✔ multiple languages at root — one marked primary (162.849713ms)
  ✔ primary language detection (333.818612ms)
  ▶ package manager detection
    ✔ detects pnpm from pnpm-lock.yaml (164.518775ms)
    ✔ detects npm from package-lock.json (189.480347ms)
    ✔ pnpm takes precedence over npm when both present (139.365965ms)
    ✔ packageManager field overrides lockfile detection (131.275113ms)
  ✔ package manager detection (625.17895ms)
  ▶ binary availability
    ✔ binary check returns available:false for missing binary (112.481462ms)
    ✔ node binary should be available (running in Node.js) (139.740216ms)
  ✔ binary availability (252.596611ms)
  ▶ skip directories
    ✔ does NOT detect files in node_modules (116.089709ms)
    ✔ does NOT detect files in vendor directory (121.458315ms)
  ✔ skip directories (238.025227ms)
  ▶ version manager detection
    ✔ detects .nvmrc with version (115.33384ms)
    ✔ detects mise.toml (111.400376ms)
    ✔ detects .tool-versions (asdf) (110.591251ms)
  ✔ version manager detection (340.134218ms)
  ▶ infrastructure detection
    ✔ detects services from docker-compose.yml (152.353102ms)
    ✔ detects MCP servers from .mcp.json (114.534882ms)
  ✔ infrastructure detection (267.135936ms)
  ▶ script detection
    ✔ captures well-known scripts from package.json (106.354128ms)
    ✔ captures Makefile targets (98.79079ms)
  ✔ script detection (205.353579ms)
  ▶ monorepo detection
    ✔ detects npm workspaces from package.json (130.397989ms)
    ✔ no monorepo in simple project (183.38947ms)
  ✔ monorepo detection (314.03581ms)
  ▶ edge cases
    ✔ permission-denied directory does not crash (130.857929ms)
    ✔ deeply nested symlink does not cause infinite loop (depth limit handles this) (195.769778ms)
    ✔ CI detection: github actions (146.466186ms)
    ✔ linter/formatter detection (72.235033ms)
    ✔ test framework detection from config files (101.520556ms)
  ✔ edge cases (647.460297ms)
  ▶ detection against real project
    ✔ gsd-opencode project detects node and npm (99.527067ms)
  ✔ detection against real project (99.674149ms)
  ▶ manifest persistence
    ✔ env scan writes env-manifest.json when .planning/ exists (131.176983ms)
    ✔ env scan does NOT write manifest when .planning/ does not exist (156.502885ms)
    ✔ env scan writes project-profile.json when .planning/ exists (141.586181ms)
    ✔ env scan creates .planning/.gitignore with env-manifest.json entry (162.984275ms)
    ✔ env scan watched_files includes root manifest files (125.230744ms)
  ✔ manifest persistence (718.075795ms)
  ▶ staleness detection
    ✔ staleness: fresh manifest is NOT stale (297.628129ms)
    ✔ staleness: touching a watched file makes manifest stale (306.854188ms)
    ✔ staleness: missing manifest reports stale with reason no_manifest (124.992121ms)
    ✔ staleness: --force flag bypasses staleness and always rescans (336.402993ms)
    ✔ staleness: auto-rescan re-writes manifest when stale (563.815964ms)
    ✔ env status returns correct structure (238.518786ms)
    ✔ env scan idempotent: second run without changes exits early (286.981188ms)
  ✔ staleness detection (2156.047502ms)
  ▶ env integration - formatEnvSummary
    ✔ formatEnvSummary with node+go+elixir manifest produces compact format (110.025609ms)
    ✔ formatEnvSummary with null manifest returns null (143.143873ms)
    ✔ formatEnvSummary with empty languages returns null (127.692737ms)
    ✔ formatEnvSummary with missing binary includes "(no binary)" suffix (113.248663ms)
    ✔ formatEnvSummary includes docker when docker_services detected (118.980154ms)
  ✔ env integration - formatEnvSummary (613.687691ms)
  ▶ env integration - autoTriggerEnvScan
    ✔ auto-trigger creates manifest on first init progress (175.376995ms)
    ✔ auto-trigger returns existing manifest when fresh (252.305859ms)
    ✔ init execute-phase includes env_summary (137.214161ms)
    ✔ env status returns correct JSON structure (245.886991ms)
  ✔ env integration - autoTriggerEnvScan (811.181623ms)
  ▶ env integration - full flow
    ✔ create project, scan, verify status, then init progress with tools line (429.569326ms)
  ✔ env integration - full flow (429.715117ms)
✔ env scan (13108.867778ms)
▶ mcp-profile
  ▶ server discovery from .mcp.json
    ✔ discovers servers from .mcp.json (160.378325ms)
  ✔ server discovery from .mcp.json (160.573587ms)
  ▶ server discovery from opencode.json
    ✔ discovers servers from opencode.json (113.153206ms)
  ✔ server discovery from opencode.json (113.361115ms)
  ▶ remote MCP server discovery
    ✔ discovers remote servers with correct transport (82.394944ms)
  ✔ remote MCP server discovery (82.603159ms)
  ▶ server merging from both configs
    ✔ merges servers from both configs with deduplication (136.497184ms)
  ✔ server merging from both configs (136.7338ms)
  ▶ known server token estimation
    ✔ estimates known server tokens correctly (86.708859ms)
    ✔ estimates unknown server with default (115.711111ms)
  ✔ known server token estimation (202.674919ms)
  ▶ total context calculation
    ✔ total_tokens is sum of individual estimates (145.131741ms)
  ✔ total context calculation (145.411373ms)
  ▶ custom window size
    ✔ --window flag changes context_window and percentages (117.140085ms)
  ✔ custom window size (117.364307ms)
  ▶ empty config
    ✔ empty directory with no user config returns empty results (114.082757ms)
  ✔ empty config (114.212719ms)
  ▶ malformed config
    ✔ invalid JSON in .mcp.json degrades gracefully (117.790198ms)
    ✔ missing mcpServers key in .mcp.json returns empty (87.651714ms)
    ✔ missing mcp key in opencode.json returns empty (74.548777ms)
  ✔ malformed config (280.351531ms)
  ▶ user-level config discovery
    ✔ discovers servers from user-level config (170.466845ms)
  ✔ user-level config discovery (170.641605ms)
  ▶ mcp subcommand syntax
    ✔ mcp profile works as alias (133.117976ms)
  ✔ mcp subcommand syntax (133.314782ms)
  ▶ known/unknown counts
    ✔ correctly splits known vs unknown servers (124.710633ms)
  ✔ known/unknown counts (124.82146ms)
  ▶ relevance scoring
    ✔ scores relevant server with matching project files (117.115065ms)
    ✔ scores not-relevant server without matching files (92.963309ms)
    ✔ always-relevant servers scored relevant regardless of project files (84.126503ms)
    ✔ low-cost server marked relevant even without indicators (77.071816ms)
    ✔ unknown server gets possibly-relevant (96.3785ms)
    ✔ recommendations summary counts are correct (131.690052ms)
    ✔ total potential savings equals sum of disabled server tokens (134.899465ms)
    ✔ env hint detection for possibly-relevant (116.126882ms)
  ✔ relevance scoring (851.105646ms)
  ▶ apply and restore
    ✔ apply creates backup (132.121548ms)
    ✔ apply disables recommended servers (124.419318ms)
    ✔ apply only modifies opencode.json servers (119.960403ms)
    ✔ apply returns correct summary (144.261042ms)
    ✔ apply with no opencode.json (113.506567ms)
    ✔ restore from backup (246.019933ms)
    ✔ restore without backup (93.817485ms)
    ✔ apply preserves non-MCP config (132.121156ms)
    ✔ idempotent apply (270.343948ms)
  ✔ apply and restore (1377.50968ms)
✔ mcp-profile (4012.240949ms)
▶ assertions commands
  ✔ parseAssertionsMd with sample content returns 3 requirements (93.612035ms)
  ✔ assertions list counts must-have and nice-to-have correctly (102.34033ms)
  ✔ assertions list --req filters to specific requirement (127.227255ms)
  ✔ assertions list preserves when/then/type fields (113.27525ms)
  ✔ assertions list with missing ASSERTIONS.md returns soft error (99.706991ms)
  ✔ assertions validate reports valid for well-formed content (153.663988ms)
  ✔ assertions validate catches missing assert field (115.524283ms)
  ✔ assertions validate catches invalid type value (103.268676ms)
  ✔ assertions validate warns when req not in REQUIREMENTS.md (143.975428ms)
  ✔ assertions validate computes coverage percent (114.312819ms)
  ✔ assertions validate with missing ASSERTIONS.md returns soft error (163.212357ms)
  ✔ parseAssertionsMd handles empty content gracefully (123.514331ms)
  ✔ assertions list rawValue has correct format (124.626801ms)
✔ assertions commands (1579.610137ms)
▶ verify requirements with assertions
  ✔ verify requirements backward compatible when no ASSERTIONS.md (130.051415ms)
  ✔ verify requirements includes per-assertion pass/fail when ASSERTIONS.md exists (148.434331ms)
  ✔ verify requirements coverage percentage calculated correctly (152.477488ms)
  ✔ verify requirements must-have vs nice-to-have filtering in output (90.09977ms)
  ✔ verify requirements file-type assertions check disk existence (137.181339ms)
  ✔ verify requirements test-command column parsing (118.891592ms)
  ✔ verify requirements rawValue includes assertion stats when assertions present (96.010996ms)
  ✔ verify requirements failed must-have assertions include gap_description (96.57557ms)
✔ verify requirements with assertions (970.58737ms)
▶ trace-requirement with assertions
  ✔ trace-requirement shows assertion data when ASSERTIONS.md present (104.714348ms)
  ✔ trace-requirement backward compatible without ASSERTIONS.md (130.895519ms)
  ✔ trace-requirement chain format is correct (138.305612ms)
  ✔ trace-requirement assertion planned/implemented status with summary (108.27387ms)
  ✔ trace-requirement assertion gap detection for unplanned assertions (127.123093ms)
✔ trace-requirement with assertions (609.797491ms)
▶ worktree commands
  ▶ worktree list
    ✔ returns empty worktrees array when no worktrees exist (191.98268ms)
    ✔ returns worktree details after create (378.477726ms)
    ✔ only shows worktrees for current project (396.813717ms)
  ✔ worktree list (967.666855ms)
  ▶ worktree create
    ✔ creates worktree at expected path with correct branch (249.484898ms)
    ✔ syncs .env file if it exists in source project (250.905603ms)
    ✔ skips sync gracefully when .env does not exist (269.322181ms)
    ✔ returns setup_failed when setup hook fails (274.398947ms)
    ✔ returns error when plan_id is missing (212.512061ms)
    ✔ returns error when worktree already exists for same plan_id (421.319106ms)
    ✔ respects max_concurrent limit (387.944276ms)
  ✔ worktree create (2066.855415ms)
  ▶ worktree remove
    ✔ removes worktree and deletes branch (418.87838ms)
    ✔ returns error for non-existent plan_id (202.048982ms)
  ✔ worktree remove (621.291544ms)
  ▶ worktree cleanup
    ✔ removes all project worktrees (845.847253ms)
    ✔ returns cleaned: 0 when no worktrees exist (217.094949ms)
  ✔ worktree cleanup (1063.220447ms)
  ▶ worktree config
    ✔ default config used when no worktree section in config.json (191.286429ms)
    ✔ custom base_path is respected (233.73371ms)
    ✔ resource warnings included when memory is low for max_concurrent (250.788253ms)
  ✔ worktree config (676.308977ms)
  ▶ worktree parsePlanId (via CLI)
    ✔ rejects invalid plan ID format (213.95631ms)
  ✔ worktree parsePlanId (via CLI) (214.158468ms)
  ▶ worktree merge
    ✔ clean merge succeeds when worktree modifies unique file (462.579846ms)
    ✔ conflict detected and blocked when both sides modify same file (437.309611ms)
    ✔ lockfile auto-resolution: package-lock.json conflict auto-resolved (535.798919ms)
    ✔ file overlap warning included in merge output (437.740325ms)
    ✔ merge of non-existent plan_id returns error (211.793934ms)
    ✔ merge with no commits in worktree succeeds as no-op (467.319906ms)
  ✔ worktree merge (2553.326626ms)
  ▶ worktree check-overlap
    ✔ no overlap between plans with different files_modified (179.696471ms)
    ✔ overlap detected within same wave (176.617263ms)
    ✔ no overlap when plans are in different waves (198.006882ms)
    ✔ handles missing files_modified gracefully (228.341352ms)
    ✔ three plans with no shared files returns empty overlaps (221.535445ms)
  ✔ worktree check-overlap (1004.754738ms)
✔ worktree commands (9168.527011ms)
▶ init execute-phase worktree fields
  ✔ worktree fields present when enabled (225.677786ms)
  ✔ worktree fields default when disabled (196.020921ms)
  ✔ file overlaps detected in init output (216.527083ms)
  ✔ no overlap when plans are in different waves (260.295757ms)
  ✔ active worktrees included when they exist (435.536651ms)
  ✔ init graceful when worktree base_path does not exist yet (219.018122ms)
  ✔ config max_concurrent surfaces in init output (266.09038ms)
✔ init execute-phase worktree fields (1819.922422ms)
▶ session-summary command
  ✔ returns valid JSON with all required fields when STATE.md exists (137.732262ms)
  ✔ returns error JSON when STATE.md is missing (118.069428ms)
  ✔ correctly identifies next action when current phase is complete (93.73286ms)
  ✔ suggests plan-phase when next phase has no plans (115.425636ms)
✔ session-summary command (465.524222ms)
▶ codebase intelligence
  ▶ codebase analyze
    ✔ codebase analyze --raw succeeds on a project with source files (170.079612ms)
    ✔ codebase analyze creates codebase-intel.json (204.410018ms)
    ✔ intel JSON has required fields (174.614666ms)
    ✔ running analyze twice — second run reports incremental or cached mode (282.360437ms)
    ✔ codebase analyze --full forces full analysis (385.662047ms)
  ✔ codebase analyze (1217.725516ms)
  ▶ codebase status
    ✔ codebase status before analyze returns exists: false (167.985623ms)
    ✔ codebase status after analyze returns exists: true, stale: false (401.537351ms)
    ✔ after modifying a tracked file, status returns stale: true (374.333911ms)
  ✔ codebase status (944.233865ms)
  ▶ incremental analysis
    ✔ after modifying one file, analyze reports incremental mode (437.855353ms)
  ✔ incremental analysis (438.056696ms)
  ▶ error handling
    ✔ codebase analyze on directory with .planning handles gracefully (213.154772ms)
    ✔ corrupt codebase-intel.json triggers full rescan (396.805987ms)
  ✔ error handling (610.24573ms)
  ▶ init integration
    ✔ init execute-phase includes codebase_stats when intel exists (396.85503ms)
    ✔ init execute-phase returns null codebase fields without intel (190.80998ms)
    ✔ init progress includes codebase_intel_exists flag (388.540757ms)
  ✔ init integration (976.605548ms)
  ▶ phase 26: init context summary
    ✔ three-field summary format — codebase_stats has confidence (362.585426ms)
    ✔ convention field present when conventions data exists (520.844722ms)
    ✔ dependencies field present when deps data exists (487.901857ms)
    ✔ null handling — stats exist but no conventions/deps data (377.110856ms)
    ✔ hybrid staleness — time-based detection (327.329334ms)
    ✔ lock file prevents concurrent background triggers (397.220801ms)
    ✔ stale lock file gets cleaned up (361.130222ms)
    ✔ --refresh forces synchronous analysis with fresh data (402.048894ms)
  ✔ phase 26: init context summary (3237.342326ms)
✔ codebase intelligence (7424.986489ms)
▶ codebase conventions
  ✔ naming detection — detects camelCase, snake_case, and kebab-case files (294.431581ms)
  ✔ file organization — detects nested structure and test placement (362.159642ms)
  ✔ confidence scoring — 9 snake_case + 1 camelCase yields ~90% snake_case confidence (375.840377ms)
  ✔ rules generation — sorted by confidence with ≤15 rules (467.304445ms)
  ✔ rules cap — conventions with many patterns still output ≤15 rules (445.088744ms)
  ✔ CLI integration — codebase rules --raw outputs plain text (340.714326ms)
✔ codebase conventions (2286.162019ms)
▶ dependency graph
  ▶ import parsers
    ✔ JS parser: require and import from (1.604573ms)
    ✔ TS parser: import types and export from (0.451584ms)
    ✔ Python parser: import and from import (1.273691ms)
    ✔ Go parser: single and grouped imports (0.796537ms)
    ✔ Elixir parser: alias, use, import (0.835245ms)
    ✔ Rust parser: use, mod, extern crate (0.983514ms)
  ✔ import parsers (7.764437ms)
  ▶ graph construction
    ✔ build graph from 3 JS files with imports (2.094505ms)
    ✔ files with no imports appear with empty edge lists (0.593481ms)
    ✔ graph built from intel object has correct adjacency structure (0.632175ms)
  ✔ graph construction (3.505484ms)
  ▶ cycle detection
    ✔ no cycles in linear chain A→B→C (0.573285ms)
    ✔ simple cycle A→B→A detected (0.213737ms)
    ✔ complex cycle A→B→C→A with D→B spur — cycle detected, D not in cycle (0.296234ms)
  ✔ cycle detection (1.230433ms)
  ▶ impact analysis
    ✔ getTransitiveDependents on leaf file returns fan_in 0 (0.444743ms)
    ✔ getTransitiveDependents on core file returns correct direct + transitive counts (0.284057ms)
  ✔ impact analysis (0.839391ms)
✔ dependency graph (13.819199ms)
▶ codebase context
  ✔ basic output structure: success, files, file_count (542.729512ms)
  ✔ per-file fields present: imports, dependents, risk_level, relevance_score (130.297063ms)
  ✔ no-data stub for nonexistent file (148.257195ms)
  ✔ imports capped at 8 (132.305766ms)
  ✔ dependents capped at 8 (116.542207ms)
  ✔ risk level: computeRiskLevel returns "high" for >10 reverse edges (135.372901ms)
  ✔ risk level: file with few dependents returns "normal" (161.71635ms)
  ✔ relevance score: target file gets score 1.0 (150.958753ms)
  ✔ relevance score: --plan flag provides plan-scope signal (183.039019ms)
  ✔ token budget respected: 10+ files output under 20K chars (110.565518ms)
  ✔ truncation flag is boolean (149.06805ms)
  ✔ usage error when no files provided (126.344282ms)
  ✔ multiple files: all requested files appear in output (104.278969ms)
  ✔ conventions field: either null or has naming property (118.193941ms)
✔ codebase context (2310.996998ms)
▶ codebase lifecycle
  ✔ LIFECYCLE_DETECTORS registry exists and contains expected detectors (0.992746ms)
  ✔ generic-migrations detector activates when migration files present (1.172168ms)
  ✔ generic-migrations extracts sequential chain with correct ordering (1.971128ms)
  ✔ elixir-phoenix detector gates on conventions.frameworks (0.582081ms)
  ✔ buildLifecycleGraph returns correct structure with no lifecycle patterns (1.846667ms)
  ✔ buildLifecycleGraph produces chains with topological sort (1.704986ms)
  ✔ buildLifecycleGraph caps migrations at MAX_MIGRATION_NODES with summary node (2.17873ms)
  ✔ codebase lifecycle --raw returns valid JSON schema (339.022672ms)
  ✔ codebase lifecycle --raw detects migration chain in temp project (312.219652ms)
  ✔ codebase lifecycle --raw returns 0 nodes for project without lifecycle patterns (283.393415ms)
  ✔ codebase lifecycle caches result in intel file (322.038019ms)
  ✔ codebase lifecycle fails gracefully without prior analyze (192.986178ms)
✔ codebase lifecycle (1461.148153ms)
▶ git log
  ✔ git log returns structured output with hash/author/date/message/files (245.281497ms)
  ✔ git log --count 1 returns only 1 commit (203.631881ms)
  ✔ git log parses conventional commits (231.88477ms)
  ✔ git log includes file stats per commit (203.451792ms)
✔ git log (884.721432ms)
▶ git diff-summary
  ✔ git diff-summary returns files/insertions/deletions (208.852983ms)
✔ git diff-summary (209.028302ms)
▶ git blame
  ✔ git blame returns line-to-commit mapping (199.05082ms)
✔ git blame (199.23894ms)
▶ git branch-info
  ✔ git branch-info returns branch name and state (152.308865ms)
  ✔ git branch-info detects detached HEAD (197.441766ms)
✔ git branch-info (350.20571ms)
▶ pre-commit checks
  ✔ commit with dirty non-.planning files is blocked (150.931525ms)
  ✔ commit --force bypasses dirty file check (198.768651ms)
  ✔ commit in detached HEAD is blocked (180.461785ms)
  ✔ commit in clean state proceeds normally (188.247118ms)
  ✔ multiple pre-commit failures reported together (258.898718ms)
✔ pre-commit checks (978.162695ms)
▶ commit --agent attribution
  ✔ commit --agent gsd-executor produces commit with Agent-Type trailer (225.796078ms)
  ✔ commit without --agent has no Agent-Type trailer (251.244469ms)
✔ commit --agent attribution (477.332698ms)
▶ contract: init phase-op (full snapshot)
  ✔ init phase-op output matches snapshot (159.874245ms)
✔ contract: init phase-op (full snapshot) (160.083702ms)
▶ contract: state read (full snapshot)
  ✔ state read output matches snapshot (113.658939ms)
✔ contract: state read (full snapshot) (113.848401ms)
▶ contract: init plan-phase fields
  ✔ init plan-phase has required fields (115.565075ms)
  ✔ adding new field to plan-phase does not break contract (127.986427ms)
✔ contract: init plan-phase fields (243.807972ms)
▶ contract: init new-project fields
  ✔ init new-project has required fields (171.656462ms)
✔ contract: init new-project fields (171.870786ms)
▶ contract: init execute-phase fields
  ✔ init execute-phase has required fields (113.419891ms)
✔ contract: init execute-phase fields (113.640656ms)
▶ contract: state read fields
  ✔ state read has required fields (125.106525ms)
✔ contract: state read fields (125.312731ms)
▶ contract: init progress fields
  ✔ init progress has required fields (119.965439ms)
✔ contract: init progress fields (120.076494ms)
▶ profiler
  ✔ profiler disabled by default — no baselines created (131.465487ms)
  ✔ profiler enabled writes baseline (142.853861ms)
  ✔ profiler baseline JSON structure (104.795809ms)
  ✔ profiler zero-cost when disabled (62.76814ms)
✔ profiler (442.262052ms)
▶ codebase ast command
  ✔ codebase ast on JS file with functions returns signatures (143.634499ms)
  ✔ codebase ast on JS file with classes returns class + method signatures (141.756365ms)
  ✔ codebase ast on CJS file with module.exports returns signatures (149.380859ms)
  ✔ codebase ast on non-existent file returns error gracefully (95.36334ms)
  ✔ codebase ast on Python file returns regex-extracted signatures (136.835839ms)
  ✔ codebase ast on unknown extension returns empty signatures, no crash (135.861799ms)
✔ codebase ast command (803.378227ms)
▶ codebase exports command
  ✔ codebase exports on ESM file returns named/default exports (135.411557ms)
  ✔ codebase exports on CJS file returns cjs_exports (85.747606ms)
  ✔ codebase exports on non-existent file returns error gracefully (149.239907ms)
✔ codebase exports command (370.741701ms)
▶ codebase complexity command
  ✔ simple function with no branching has complexity 1 (129.320808ms)
  ✔ function with if/else/for has complexity reflecting branch count (163.080752ms)
  ✔ nested control flow reflects nesting depth (85.243634ms)
  ✔ module complexity is sum of function complexities (100.538808ms)
  ✔ non-existent file returns graceful error (143.855334ms)
  ✔ logical operators contribute to complexity (108.644452ms)
✔ codebase complexity command (731.150296ms)
▶ codebase repo-map command
  ✔ repo map returns summary string with file entries (161.399858ms)
  ✔ repo map token_estimate is roughly within budget (177.847955ms)
  ✔ repo map includes source files with signatures (155.888224ms)
  ✔ repo map --budget flag controls output size (301.211046ms)
✔ codebase repo-map command (796.770456ms)
▶ codebase repo-map integration
  ✔ repo-map on gsd-tools project produces valid JSON with files > 0 (531.6119ms)
✔ codebase repo-map integration (531.774866ms)
▶ orchestration: classifyTaskComplexity
  ✔ minimal task (1 file, no tests) scores 1-2 (202.150112ms)
  ✔ complex task (4+ files, tests, long action) scores 4-5 (102.250164ms)
  ✔ moderate task (3 files, tests) scores 3 (179.380642ms)
✔ orchestration: classifyTaskComplexity (484.100998ms)
▶ orchestration: parseTasksFromPlan
  ✔ extracts tasks from plan XML correctly (115.513013ms)
  ✔ handles malformed XML gracefully (129.0765ms)
✔ orchestration: parseTasksFromPlan (244.832937ms)
▶ orchestration: selectExecutionMode
  ✔ single plan with 1-2 tasks returns mode "single" (142.008004ms)
  ✔ multiple same-wave plans returns mode "parallel" (114.541883ms)
  ✔ plans with checkpoints returns mode "sequential" (91.522926ms)
✔ orchestration: selectExecutionMode (348.432581ms)
▶ orchestration: classify plan CLI
  ✔ returns JSON with task scores for a real plan (156.369974ms)
✔ orchestration: classify plan CLI (156.590153ms)
▶ orchestration: classify phase CLI
  ✔ classify phase 38 returns classifications for completed plans (221.274502ms)
✔ orchestration: classify phase CLI (221.481798ms)
▶ orchestration: init execute-phase integration
  ✔ init execute-phase on incomplete phase includes task_routing field (160.466273ms)
✔ orchestration: init execute-phase integration (160.638231ms)
▶ agent manifests: AGENT_MANIFESTS structure
  ✔ has entries for all 6 agent types (0.448571ms)
  ✔ gsd-reviewer manifest has review-scoped fields (0.217731ms)
✔ agent manifests: AGENT_MANIFESTS structure (0.825754ms)
▶ agent manifests: scopeContextForAgent
  ✔ gsd-executor gets task_routing but not intent_drift (0.667949ms)
  ✔ gsd-verifier gets phase_dir but not task_routing (0.334515ms)
  ✔ unknown agent type returns full result (0.241059ms)
  ✔ _savings shows reduction percentage (1.974762ms)
  ✔ gsd-reviewer gets codebase_conventions but not incomplete_plans (1.68846ms)
✔ agent manifests: scopeContextForAgent (5.282471ms)
▶ agent manifests: compactPlanState
  ✔ reduces STATE.md to compact object with phase, progress, status (2.215598ms)
  ✔ decisions limited to last 5 (1.348008ms)
  ✔ empty/missing state returns sensible defaults (0.527297ms)
✔ agent manifests: compactPlanState (4.495475ms)
▶ agent manifests: compactDepGraph
  ✔ reduces dep data, keeps top_imported capped at 5 (1.082903ms)
  ✔ null/undefined input returns empty object (0.259699ms)
✔ agent manifests: compactDepGraph (1.591714ms)
▶ agent manifests: init --agent integration
  ✔ init execute-phase --agent=gsd-executor returns scoped output (209.137833ms)
  ✔ init execute-phase --agent=gsd-verifier returns fewer fields than executor (384.635315ms)
✔ agent manifests: init --agent integration (594.325516ms)
▶ buildTaskContext: unit tests
  ✔ single task file with known deps returns task file + 1-hop deps scored (644.866106ms)
  ✔ multiple task files returns union of deps with no duplicates (340.236362ms)
  ✔ token budget enforced: drops lowest-scored files when over budget (633.842025ms)
  ✔ no codebase intel: graceful fallback returning just task files (7.195924ms)
  ✔ includeSignatures=true adds signatures array to context files (312.449058ms)
  ✔ empty task files returns empty context with zero stats (0.236789ms)
✔ buildTaskContext: unit tests (1939.370804ms)
▶ buildTaskContext: integration tests (CLI)
  ✔ codebase context --task returns JSON with context_files and stats (637.877357ms)
  ✔ codebase context --task with --budget respects budget, fewer files (1207.41742ms)
  ✔ stats.reduction_pct > 0 proves context was reduced vs all candidates (722.720273ms)
  ✔ quality baseline: known task includes direct deps and importers (335.977627ms)
✔ buildTaskContext: integration tests (CLI) (2904.332222ms)
▶ review command
  ✔ review without args returns error (116.281788ms)
  ✔ review 37 01 returns JSON with commits, diff, and conventions fields (415.181386ms)
  ✔ review output includes files_changed array (341.946597ms)
✔ review command (873.680389ms)
▶ tdd
  ✔ validate-red succeeds when test fails (exit 1) (120.750726ms)
  ✔ validate-red fails when test passes (exit 0) (126.714805ms)
  ✔ validate-green succeeds when test passes (exit 0) (114.380578ms)
  ✔ validate-green fails when test fails (exit 1) (131.175586ms)
  ✔ validate-refactor succeeds when test passes (85.377803ms)
  ✔ auto-test reports pass (99.835467ms)
  ✔ auto-test reports fail (98.042736ms)
  ✔ detect-antipattern warns on non-test source files in red phase (132.192818ms)
  ✔ detect-antipattern clean on test files in red phase (118.670253ms)
  ✔ GSD-Phase trailer on commit (175.467847ms)
✔ tdd (1203.648508ms)
ℹ tests 669
ℹ suites 173
ℹ pass 669
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 127510.33368
